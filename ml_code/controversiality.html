<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Predicting Controversiality of Comment Content</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="controversiality_files/libs/clipboard/clipboard.min.js"></script>
<script src="controversiality_files/libs/quarto-html/quarto.js"></script>
<script src="controversiality_files/libs/quarto-html/popper.min.js"></script>
<script src="controversiality_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="controversiality_files/libs/quarto-html/anchor.min.js"></script>
<link href="controversiality_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="controversiality_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="controversiality_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="controversiality_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="controversiality_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Predicting Controversiality of Comment Content</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="data-preprocessing" class="level3">
<h3 class="anchored" data-anchor-id="data-preprocessing">Data Preprocessing:</h3>
</section>
<section id="select-relevant-variables" class="level3">
<h3 class="anchored" data-anchor-id="select-relevant-variables">Select relevant variables</h3>
<p>Choose relevant columns to do the predictive analysis</p>
<section id="handle-missing-values" class="level4">
<h4 class="anchored" data-anchor-id="handle-missing-values">Handle Missing Values:</h4>
<p>Check for missing values in the DataFrame and decide on a strategy for handling them, such as imputation or removal.</p>
</section>
<section id="convert-timestamp-variables" class="level4">
<h4 class="anchored" data-anchor-id="convert-timestamp-variables">Convert Timestamp Variables:</h4>
<p>Extract relevant features from timestamp variables like ‘created_utc’ and ‘retrieved_on’ (e.g., day of the week, hour of the day).</p>
</section>
</section>
<section id="split-the-data" class="level3">
<h3 class="anchored" data-anchor-id="split-the-data">Split the Data:</h3>
<p>Split the DataFrame into training and testing sets to evaluate the model’s performance.</p>
</section>
<section id="build-a-predictive-model" class="level3">
<h3 class="anchored" data-anchor-id="build-a-predictive-model">Build a Predictive Model:</h3>
<section id="choose-a-machine-learning-model" class="level4">
<h4 class="anchored" data-anchor-id="choose-a-machine-learning-model">Choose a Machine Learning Model:</h4>
<p>Select a model suitable for predicting the target variable (controversiality). Common choices include decision trees, random forests, support vector machines, or gradient boosting algorithms.</p>
</section>
<section id="train-the-model" class="level4">
<h4 class="anchored" data-anchor-id="train-the-model">Train the Model:</h4>
<p>Use the training set to train the selected model.</p>
</section>
</section>
<section id="model-evaluation" class="level3">
<h3 class="anchored" data-anchor-id="model-evaluation">Model Evaluation:</h3>
<p>Evaluate the model on the testing set using appropriate evaluation metrics such as accuracy, precision, recall, or F1 score.</p>
<section id="tune-hyperparameters" class="level4">
<h4 class="anchored" data-anchor-id="tune-hyperparameters">Tune Hyperparameters:</h4>
<p>Optimize the model’s hyperparameters to improve performance.</p>
</section>
</section>
<section id="interpret-results" class="level3">
<h3 class="anchored" data-anchor-id="interpret-results">Interpret Results:</h3>
<section id="analyze-predictions" class="level4">
<h4 class="anchored" data-anchor-id="analyze-predictions">Analyze Predictions:</h4>
<p>Examine the model’s predictions and understand the importance of each feature in predicting controversiality.</p>
</section>
<section id="iterate-and-improve" class="level4">
<h4 class="anchored" data-anchor-id="iterate-and-improve">Iterate and Improve:</h4>
<p>Based on the results, refine the model or consider additional features to enhance predictive performance.</p>
<div class="cell" data-tags="[]" data-execution_count="8">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup - Run only once per Kernel App</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>conda install openjdk <span class="op">-</span>y</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># install PySpark</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># install Python Reddit API Wrapper for getting external data Karma</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip install pyspark<span class="op">==</span><span class="fl">3.4.0</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># install spark-nlp</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip install spark<span class="op">-</span>nlp<span class="op">==</span><span class="fl">5.1.3</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># restart kernel</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.core.display <span class="im">import</span> HTML</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>HTML(<span class="st">"&lt;script&gt;Jupyter.notebook.kernel.restart()&lt;/script&gt;"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Collecting package metadata (current_repodata.json): done
Solving environment: done


==&gt; WARNING: A newer version of conda exists. &lt;==
  current version: 23.3.1
  latest version: 23.10.0

Please update conda by running

    $ conda update -n base -c defaults conda

Or to minimize the number of packages updated during conda update use

     conda install conda=23.10.0



## Package Plan ##

  environment location: /opt/conda

  added / updated specs:
    - openjdk


The following packages will be downloaded:

    package                    |            build
    ---------------------------|-----------------
    ca-certificates-2023.08.22 |       h06a4308_0         123 KB
    certifi-2023.11.17         |  py310h06a4308_0         158 KB
    openjdk-11.0.13            |       h87a67e3_0       341.0 MB
    ------------------------------------------------------------
                                           Total:       341.3 MB

The following NEW packages will be INSTALLED:

  openjdk            pkgs/main/linux-64::openjdk-11.0.13-h87a67e3_0 

The following packages will be UPDATED:

  ca-certificates    conda-forge::ca-certificates-2023.7.2~ --&gt; pkgs/main::ca-certificates-2023.08.22-h06a4308_0 
  certifi            conda-forge/noarch::certifi-2023.7.22~ --&gt; pkgs/main/linux-64::certifi-2023.11.17-py310h06a4308_0 



Downloading and Extracting Packages
ca-certificates-2023 | 123 KB    |                                       |   0% 
certifi-2023.11.17   | 158 KB    |                                       |   0% 

ca-certificates-2023 | 123 KB    | ##################################### | 100% 
certifi-2023.11.17   | 158 KB    | ##################################### | 100% 

openjdk-11.0.13      | 341.0 MB  | 3                                     |   1% 

openjdk-11.0.13      | 341.0 MB  | #9                                    |   5% 

openjdk-11.0.13      | 341.0 MB  | ###6                                  |  10% 

openjdk-11.0.13      | 341.0 MB  | #####2                                |  14% 

openjdk-11.0.13      | 341.0 MB  | ######9                               |  19% 

openjdk-11.0.13      | 341.0 MB  | ########6                             |  23% 

openjdk-11.0.13      | 341.0 MB  | ##########4                           |  28% 

openjdk-11.0.13      | 341.0 MB  | ############5                         |  34% 

openjdk-11.0.13      | 341.0 MB  | ##############4                       |  39% 

openjdk-11.0.13      | 341.0 MB  | ################2                     |  44% 

openjdk-11.0.13      | 341.0 MB  | #################8                    |  48% 

openjdk-11.0.13      | 341.0 MB  | ###################3                  |  52% 

openjdk-11.0.13      | 341.0 MB  | ####################9                 |  57% 

openjdk-11.0.13      | 341.0 MB  | ######################5               |  61% 

openjdk-11.0.13      | 341.0 MB  | ########################1             |  65% 

openjdk-11.0.13      | 341.0 MB  | #########################7            |  69% 

openjdk-11.0.13      | 341.0 MB  | ###########################1          |  73% 

openjdk-11.0.13      | 341.0 MB  | ############################6         |  77% 

openjdk-11.0.13      | 341.0 MB  | ##############################2       |  82% 

openjdk-11.0.13      | 341.0 MB  | ###############################7      |  86% 

openjdk-11.0.13      | 341.0 MB  | #################################3    |  90% 

openjdk-11.0.13      | 341.0 MB  | ##################################8   |  94% 

openjdk-11.0.13      | 341.0 MB  | ####################################3 |  98% 

                                                                                
                                                                                

                                                                                
Preparing transaction: done
Verifying transaction: done
Executing transaction: done

Note: you may need to restart the kernel to use updated packages.
Collecting pyspark==3.4.0
  Using cached pyspark-3.4.0-py2.py3-none-any.whl
Collecting py4j==0.10.9.7 (from pyspark==3.4.0)
  Using cached py4j-0.10.9.7-py2.py3-none-any.whl (200 kB)
Installing collected packages: py4j, pyspark
Successfully installed py4j-0.10.9.7 pyspark-3.4.0
WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv

[notice] A new release of pip is available: 23.2.1 -&gt; 23.3.1
[notice] To update, run: pip install --upgrade pip
Note: you may need to restart the kernel to use updated packages.
Collecting spark-nlp==5.1.3
  Obtaining dependency information for spark-nlp==5.1.3 from https://files.pythonhosted.org/packages/cd/7d/bc0eca4c9ec4c9c1d9b28c42c2f07942af70980a7d912d0aceebf8db32dd/spark_nlp-5.1.3-py2.py3-none-any.whl.metadata
  Using cached spark_nlp-5.1.3-py2.py3-none-any.whl.metadata (53 kB)
Using cached spark_nlp-5.1.3-py2.py3-none-any.whl (537 kB)
Installing collected packages: spark-nlp
Successfully installed spark-nlp-5.1.3
WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv

[notice] A new release of pip is available: 23.2.1 -&gt; 23.3.1
[notice] To update, run: pip install --upgrade pip
Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="8">
<script>Jupyter.notebook.kernel.restart()</script>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="9">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyspark.sql.functions <span class="im">as</span> F</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sparknlp</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sparknlp.base <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml <span class="im">import</span> Pipeline</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sparknlp.annotator <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sparknlp.pretrained <span class="im">import</span> PretrainedPipeline</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.feature <span class="im">import</span> CountVectorizer, StopWordsRemover,Tokenizer</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml <span class="im">import</span> Pipeline</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.types <span class="im">import</span> ArrayType, StringType</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> udf</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.stem <span class="im">import</span> WordNetLemmatizer</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nltk</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> udf</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.types <span class="im">import</span> ArrayType, StringType</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="10">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>spark <span class="op">=</span> (</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    SparkSession.builder.appName(<span class="st">"PySparkApp"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    .config(<span class="st">"spark.driver.memory"</span>,<span class="st">"16G"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    .config(<span class="st">"spark.driver.maxResultSize"</span>, <span class="st">"0"</span>) </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    .config(<span class="st">"spark.kryoserializer.buffer.max"</span>, <span class="st">"2000M"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    .config(<span class="st">"spark.jars.packages"</span>, <span class="st">"com.johnsnowlabs.nlp:spark-nlp_2.12:5.1.3,org.apache.hadoop:hadoop-aws:3.2.2"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    .config(<span class="st">"fs.s3a.aws.credentials.provider"</span>, <span class="st">"com.amazonaws.auth.ContainerCredentialsProvider"</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    .getOrCreate()</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Ignoring non-Spark config property: fs.s3a.aws.credentials.provider
Ivy Default Cache set to: /root/.ivy2/cache
The jars for the packages stored in: /root/.ivy2/jars
com.johnsnowlabs.nlp#spark-nlp_2.12 added as a dependency
org.apache.hadoop#hadoop-aws added as a dependency
:: resolving dependencies :: org.apache.spark#spark-submit-parent-f406bcb8-9e47-4133-b2e2-94262facbf6f;1.0
    confs: [default]
    found com.johnsnowlabs.nlp#spark-nlp_2.12;5.1.3 in central
    found com.typesafe#config;1.4.2 in central
    found org.rocksdb#rocksdbjni;6.29.5 in central
    found com.amazonaws#aws-java-sdk-bundle;1.11.828 in central
    found com.github.universal-automata#liblevenshtein;3.0.0 in central
    found com.google.protobuf#protobuf-java-util;3.0.0-beta-3 in central
    found com.google.protobuf#protobuf-java;3.0.0-beta-3 in central
    found com.google.code.gson#gson;2.3 in central
    found it.unimi.dsi#fastutil;7.0.12 in central
    found org.projectlombok#lombok;1.16.8 in central
    found com.google.cloud#google-cloud-storage;2.20.1 in central
    found com.google.guava#guava;31.1-jre in central
    found com.google.guava#failureaccess;1.0.1 in central
    found com.google.guava#listenablefuture;9999.0-empty-to-avoid-conflict-with-guava in central
    found com.google.errorprone#error_prone_annotations;2.18.0 in central
    found com.google.j2objc#j2objc-annotations;1.3 in central
    found com.google.http-client#google-http-client;1.43.0 in central
    found io.opencensus#opencensus-contrib-http-util;0.31.1 in central
    found com.google.http-client#google-http-client-jackson2;1.43.0 in central
    found com.google.http-client#google-http-client-gson;1.43.0 in central
    found com.google.api-client#google-api-client;2.2.0 in central
    found commons-codec#commons-codec;1.15 in central
    found com.google.oauth-client#google-oauth-client;1.34.1 in central
    found com.google.http-client#google-http-client-apache-v2;1.43.0 in central
    found com.google.apis#google-api-services-storage;v1-rev20220705-2.0.0 in central
    found com.google.code.gson#gson;2.10.1 in central
    found com.google.cloud#google-cloud-core;2.12.0 in central
    found io.grpc#grpc-context;1.53.0 in central
    found com.google.auto.value#auto-value-annotations;1.10.1 in central
    found com.google.auto.value#auto-value;1.10.1 in central
    found javax.annotation#javax.annotation-api;1.3.2 in central
    found commons-logging#commons-logging;1.2 in central
    found com.google.cloud#google-cloud-core-http;2.12.0 in central
    found com.google.http-client#google-http-client-appengine;1.43.0 in central
    found com.google.api#gax-httpjson;0.108.2 in central
    found com.google.cloud#google-cloud-core-grpc;2.12.0 in central
    found io.grpc#grpc-alts;1.53.0 in central
    found io.grpc#grpc-grpclb;1.53.0 in central
    found org.conscrypt#conscrypt-openjdk-uber;2.5.2 in central
    found io.grpc#grpc-auth;1.53.0 in central
    found io.grpc#grpc-protobuf;1.53.0 in central
    found io.grpc#grpc-protobuf-lite;1.53.0 in central
    found io.grpc#grpc-core;1.53.0 in central
    found com.google.api#gax;2.23.2 in central
    found com.google.api#gax-grpc;2.23.2 in central
    found com.google.auth#google-auth-library-credentials;1.16.0 in central
    found com.google.auth#google-auth-library-oauth2-http;1.16.0 in central
    found com.google.api#api-common;2.6.2 in central
    found io.opencensus#opencensus-api;0.31.1 in central
    found com.google.api.grpc#proto-google-iam-v1;1.9.2 in central
    found com.google.protobuf#protobuf-java;3.21.12 in central
    found com.google.protobuf#protobuf-java-util;3.21.12 in central
    found com.google.api.grpc#proto-google-common-protos;2.14.2 in central
    found org.threeten#threetenbp;1.6.5 in central
    found com.google.api.grpc#proto-google-cloud-storage-v2;2.20.1-alpha in central
    found com.google.api.grpc#grpc-google-cloud-storage-v2;2.20.1-alpha in central
    found com.google.api.grpc#gapic-google-cloud-storage-v2;2.20.1-alpha in central
    found com.fasterxml.jackson.core#jackson-core;2.14.2 in central
    found com.google.code.findbugs#jsr305;3.0.2 in central
    found io.grpc#grpc-api;1.53.0 in central
    found io.grpc#grpc-stub;1.53.0 in central
    found org.checkerframework#checker-qual;3.31.0 in central
    found io.perfmark#perfmark-api;0.26.0 in central
    found com.google.android#annotations;4.1.1.4 in central
    found org.codehaus.mojo#animal-sniffer-annotations;1.22 in central
    found io.opencensus#opencensus-proto;0.2.0 in central
    found io.grpc#grpc-services;1.53.0 in central
    found com.google.re2j#re2j;1.6 in central
    found io.grpc#grpc-netty-shaded;1.53.0 in central
    found io.grpc#grpc-googleapis;1.53.0 in central
    found io.grpc#grpc-xds;1.53.0 in central
    found com.navigamez#greex;1.0 in central
    found dk.brics.automaton#automaton;1.11-8 in central
    found com.johnsnowlabs.nlp#tensorflow-cpu_2.12;0.4.4 in central
    found com.microsoft.onnxruntime#onnxruntime;1.15.0 in central
    found org.apache.hadoop#hadoop-aws;3.2.2 in central
:: resolution report :: resolve 5011ms :: artifacts dl 560ms
    :: modules in use:
    com.amazonaws#aws-java-sdk-bundle;1.11.828 from central in [default]
    com.fasterxml.jackson.core#jackson-core;2.14.2 from central in [default]
    com.github.universal-automata#liblevenshtein;3.0.0 from central in [default]
    com.google.android#annotations;4.1.1.4 from central in [default]
    com.google.api#api-common;2.6.2 from central in [default]
    com.google.api#gax;2.23.2 from central in [default]
    com.google.api#gax-grpc;2.23.2 from central in [default]
    com.google.api#gax-httpjson;0.108.2 from central in [default]
    com.google.api-client#google-api-client;2.2.0 from central in [default]
    com.google.api.grpc#gapic-google-cloud-storage-v2;2.20.1-alpha from central in [default]
    com.google.api.grpc#grpc-google-cloud-storage-v2;2.20.1-alpha from central in [default]
    com.google.api.grpc#proto-google-cloud-storage-v2;2.20.1-alpha from central in [default]
    com.google.api.grpc#proto-google-common-protos;2.14.2 from central in [default]
    com.google.api.grpc#proto-google-iam-v1;1.9.2 from central in [default]
    com.google.apis#google-api-services-storage;v1-rev20220705-2.0.0 from central in [default]
    com.google.auth#google-auth-library-credentials;1.16.0 from central in [default]
    com.google.auth#google-auth-library-oauth2-http;1.16.0 from central in [default]
    com.google.auto.value#auto-value;1.10.1 from central in [default]
    com.google.auto.value#auto-value-annotations;1.10.1 from central in [default]
    com.google.cloud#google-cloud-core;2.12.0 from central in [default]
    com.google.cloud#google-cloud-core-grpc;2.12.0 from central in [default]
    com.google.cloud#google-cloud-core-http;2.12.0 from central in [default]
    com.google.cloud#google-cloud-storage;2.20.1 from central in [default]
    com.google.code.findbugs#jsr305;3.0.2 from central in [default]
    com.google.code.gson#gson;2.10.1 from central in [default]
    com.google.errorprone#error_prone_annotations;2.18.0 from central in [default]
    com.google.guava#failureaccess;1.0.1 from central in [default]
    com.google.guava#guava;31.1-jre from central in [default]
    com.google.guava#listenablefuture;9999.0-empty-to-avoid-conflict-with-guava from central in [default]
    com.google.http-client#google-http-client;1.43.0 from central in [default]
    com.google.http-client#google-http-client-apache-v2;1.43.0 from central in [default]
    com.google.http-client#google-http-client-appengine;1.43.0 from central in [default]
    com.google.http-client#google-http-client-gson;1.43.0 from central in [default]
    com.google.http-client#google-http-client-jackson2;1.43.0 from central in [default]
    com.google.j2objc#j2objc-annotations;1.3 from central in [default]
    com.google.oauth-client#google-oauth-client;1.34.1 from central in [default]
    com.google.protobuf#protobuf-java;3.21.12 from central in [default]
    com.google.protobuf#protobuf-java-util;3.21.12 from central in [default]
    com.google.re2j#re2j;1.6 from central in [default]
    com.johnsnowlabs.nlp#spark-nlp_2.12;5.1.3 from central in [default]
    com.johnsnowlabs.nlp#tensorflow-cpu_2.12;0.4.4 from central in [default]
    com.microsoft.onnxruntime#onnxruntime;1.15.0 from central in [default]
    com.navigamez#greex;1.0 from central in [default]
    com.typesafe#config;1.4.2 from central in [default]
    commons-codec#commons-codec;1.15 from central in [default]
    commons-logging#commons-logging;1.2 from central in [default]
    dk.brics.automaton#automaton;1.11-8 from central in [default]
    io.grpc#grpc-alts;1.53.0 from central in [default]
    io.grpc#grpc-api;1.53.0 from central in [default]
    io.grpc#grpc-auth;1.53.0 from central in [default]
    io.grpc#grpc-context;1.53.0 from central in [default]
    io.grpc#grpc-core;1.53.0 from central in [default]
    io.grpc#grpc-googleapis;1.53.0 from central in [default]
    io.grpc#grpc-grpclb;1.53.0 from central in [default]
    io.grpc#grpc-netty-shaded;1.53.0 from central in [default]
    io.grpc#grpc-protobuf;1.53.0 from central in [default]
    io.grpc#grpc-protobuf-lite;1.53.0 from central in [default]
    io.grpc#grpc-services;1.53.0 from central in [default]
    io.grpc#grpc-stub;1.53.0 from central in [default]
    io.grpc#grpc-xds;1.53.0 from central in [default]
    io.opencensus#opencensus-api;0.31.1 from central in [default]
    io.opencensus#opencensus-contrib-http-util;0.31.1 from central in [default]
    io.opencensus#opencensus-proto;0.2.0 from central in [default]
    io.perfmark#perfmark-api;0.26.0 from central in [default]
    it.unimi.dsi#fastutil;7.0.12 from central in [default]
    javax.annotation#javax.annotation-api;1.3.2 from central in [default]
    org.apache.hadoop#hadoop-aws;3.2.2 from central in [default]
    org.checkerframework#checker-qual;3.31.0 from central in [default]
    org.codehaus.mojo#animal-sniffer-annotations;1.22 from central in [default]
    org.conscrypt#conscrypt-openjdk-uber;2.5.2 from central in [default]
    org.projectlombok#lombok;1.16.8 from central in [default]
    org.rocksdb#rocksdbjni;6.29.5 from central in [default]
    org.threeten#threetenbp;1.6.5 from central in [default]
    :: evicted modules:
    com.google.protobuf#protobuf-java-util;3.0.0-beta-3 by [com.google.protobuf#protobuf-java-util;3.21.12] in [default]
    com.google.protobuf#protobuf-java;3.0.0-beta-3 by [com.google.protobuf#protobuf-java;3.21.12] in [default]
    com.google.code.gson#gson;2.3 by [com.google.code.gson#gson;2.10.1] in [default]
    com.amazonaws#aws-java-sdk-bundle;1.11.563 by [com.amazonaws#aws-java-sdk-bundle;1.11.828] in [default]
    ---------------------------------------------------------------------
    |                  |            modules            ||   artifacts   |
    |       conf       | number| search|dwnlded|evicted|| number|dwnlded|
    ---------------------------------------------------------------------
    |      default     |   77  |   0   |   0   |   4   ||   73  |   0   |
    ---------------------------------------------------------------------
:: retrieving :: org.apache.spark#spark-submit-parent-f406bcb8-9e47-4133-b2e2-94262facbf6f
    confs: [default]
    0 artifacts copied, 73 already retrieved (0kB/167ms)
23/11/27 02:53:48 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
Setting default log level to "WARN".
To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>:: loading settings :: url = jar:file:/opt/conda/lib/python3.10/site-packages/pyspark/jars/ivy-2.5.1.jar!/org/apache/ivy/core/settings/ivysettings.xml</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="11">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sagemaker</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>session <span class="op">=</span> sagemaker.Session()</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>bucket <span class="op">=</span> session.default_bucket()</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>output_prefix_data_comments <span class="op">=</span> <span class="st">"project/comments/yyyy=*"</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>s3_path <span class="op">=</span> <span class="ss">f"s3a://</span><span class="sc">{</span>bucket<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>output_prefix_data_comments<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#s3_path = "s3a://sagemaker-us-east-1-038932893404/project/comments/yyyy=2021/part-00000-90796409-5783-4705-92c0-27c27eda8c4c-c000.snappy.parquet"</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"reading comments from </span><span class="sc">{</span>s3_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>comments <span class="op">=</span> spark.read.parquet(s3_path, header<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"shape of the comments dataframe is </span><span class="sc">{</span>comments<span class="sc">.</span>count()<span class="sc">:,}</span><span class="ss">x</span><span class="sc">{</span><span class="bu">len</span>(comments.columns)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>sampled_comments <span class="op">=</span> comments.sample(withReplacement<span class="op">=</span><span class="va">False</span>, fraction<span class="op">=</span><span class="fl">0.1</span>, seed<span class="op">=</span><span class="dv">123</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sagemaker.config INFO - Not applying SDK defaults from location: /etc/xdg/sagemaker/config.yaml
sagemaker.config INFO - Not applying SDK defaults from location: /root/.config/sagemaker/config.yaml
sagemaker.config INFO - Not applying SDK defaults from location: /etc/xdg/sagemaker/config.yaml
sagemaker.config INFO - Not applying SDK defaults from location: /root/.config/sagemaker/config.yaml
reading comments from s3a://sagemaker-us-east-1-131156463254/project/comments/yyyy=*
shape of the comments dataframe is 1,053,280x21
CPU times: user 3.41 s, sys: 250 ms, total: 3.66 s
Wall time: 5min 1s</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>23/11/27 02:54:11 WARN MetricsConfig: Cannot locate configuration: tried hadoop-metrics2-s3a-file-system.properties,hadoop-metrics2.properties
[Stage 1:======================================================&gt;(240 + 1) / 241]                                                                                </code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="48">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> col</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Select specific columns for display</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>selected_columns <span class="op">=</span> [<span class="st">"body"</span>,  <span class="st">"created_utc"</span>, <span class="st">"controversiality"</span>, <span class="st">"gilded"</span>, <span class="st">"score"</span>, <span class="st">"stickied"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'can_gild'</span>,<span class="st">'edited'</span>,<span class="st">'is_submitter'</span>]</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the selected columns</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>selected_comments<span class="op">=</span>sampled_comments.select(<span class="op">*</span>selected_columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="52">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>selected_comments.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+-------------------+----------------+------+-----+--------+--------+-------------+------------+
|                body|        created_utc|controversiality|gilded|score|stickied|can_gild|       edited|is_submitter|
+--------------------+-------------------+----------------+------+-----+--------+--------+-------------+------------+
|I get it man but ...|2022-11-11 02:05:02|               0|     0|    1|   false|    true|        false|       false|
|Nose putty and co...|2022-11-11 02:05:03|               0|     0|    1|   false|    true|        false|       false|
|I noticed the sca...|2022-11-11 02:05:09|               0|     0|    1|   false|    true|        false|       false|
|i switch between ...|2022-11-11 02:05:14|               0|     0|    1|   false|    true|        false|       false|
|https://men-elite...|2022-11-11 02:05:32|               0|     0|    1|   false|    true|        false|       false|
|Dude the first th...|2022-11-11 02:05:49|               0|     0|    1|   false|    true|        false|       false|
|That scar is fuck...|2022-11-11 02:05:55|               0|     0|    1|   false|    true|        false|       false|
| I would try Reti...|2022-11-11 02:06:11|               0|     0|    1|   false|    true|        false|       false|
| Damn, this looks...|2022-11-11 02:06:24|               0|     0|    1|   false|    true|        false|       false|
|&amp;gt; And then som...|2022-11-11 02:07:08|               0|     0|    1|   false|    true|        false|       false|
|I didn't notice t...|2022-11-11 02:07:09|               0|     0|    1|   false|    true|        false|       false|
|It’s pretty dope man|2022-11-11 02:07:27|               0|     0|    1|   false|    true|        false|       false|
|https://preview.r...|2022-11-11 02:07:29|               0|     0|    1|   false|    true|        false|       false|
|It gives your fac...|2022-11-11 02:08:10|               0|     0|    1|   false|    true|        false|       false|
|Fuck that! Show t...|2022-11-11 02:08:12|               0|     0|    1|   false|    true|        false|       false|
|&amp;gt; And then som...|2022-11-11 02:08:25|               0|     0|    1|   false|    true|1.668132686E9|       false|
|Man looks like re...|2022-11-11 02:08:48|               0|     0|    1|   false|    true|        false|       false|
|You remind me of ...|2022-11-11 02:08:54|               0|     0|    1|   false|    true|        false|       false|
|Dude the first th...|2022-11-11 02:08:59|               0|     0|    1|   false|    true|        false|       false|
|   Awesome scar tho!|2022-11-11 02:09:12|               0|     0|    1|   false|    true|        false|       false|
+--------------------+-------------------+----------------+------+-----+--------+--------+-------------+------------+
only showing top 20 rows
</code></pre>
</div>
</div>
</section>
</section>
<section id="controversiality-prediction" class="level3">
<h3 class="anchored" data-anchor-id="controversiality-prediction">Controversiality Prediction</h3>
</section>
<section id="clean-body-text" class="level3">
<h3 class="anchored" data-anchor-id="clean-body-text">Clean Body Text</h3>
<div class="cell" data-tags="[]" data-execution_count="15">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> col, regexp_replace, lower</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> lower, col, regexp_replace, udf, length, StringType</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.feature <span class="im">import</span> Tokenizer, StopWordsRemover</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_text(text):</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> re</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lowercase</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> text.lower()</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove URLs</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> re.sub(<span class="vs">r'http\S+'</span>, <span class="st">''</span>, text)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove numbers</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> re.sub(<span class="vs">r'\d+'</span>, <span class="st">''</span>, text)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove punctuation and special characters</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> re.sub(<span class="vs">r'[^a-zA-Z\s]'</span>, <span class="st">''</span>, text)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove short words (less than 3 characters)</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    text <span class="op">=</span> <span class="st">' '</span>.join([word <span class="cf">for</span> word <span class="kw">in</span> text.split() <span class="cf">if</span> <span class="bu">len</span>(word) <span class="op">&gt;</span> <span class="dv">2</span>])</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> text</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a user-defined function (UDF) for text cleaning</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>clean_text_udf <span class="op">=</span> udf(clean_text, StringType())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="54">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>cleaned_comments <span class="op">=</span> selected_comments.withColumn(<span class="st">'clean_body'</span>, clean_text_udf(col(<span class="st">'body'</span>)))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>cleaned_comments <span class="op">=</span> cleaned_comments.na.drop(subset<span class="op">=</span>[<span class="st">"clean_body"</span>])</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>cleaned_comments <span class="op">=</span> cleaned_comments.<span class="bu">filter</span>(length(col(<span class="st">'clean_body'</span>)) <span class="op">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="55">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>Contro_dataset<span class="op">=</span>cleaned_comments.select(<span class="st">"clean_body"</span>,<span class="st">"controversiality"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>Contro_dataset.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 57:&gt;                                                         (0 + 1) / 1]Traceback (most recent call last):
  File "/opt/conda/lib/python3.10/site-packages/pyspark/python/lib/pyspark.zip/pyspark/daemon.py", line 193, in manager
  File "/opt/conda/lib/python3.10/site-packages/pyspark/python/lib/pyspark.zip/pyspark/daemon.py", line 74, in worker
  File "/opt/conda/lib/python3.10/site-packages/pyspark/python/lib/pyspark.zip/pyspark/worker.py", line 874, in main
    if read_int(infile) == SpecialLengths.END_OF_STREAM:
  File "/opt/conda/lib/python3.10/site-packages/pyspark/python/lib/pyspark.zip/pyspark/serializers.py", line 596, in read_int
    raise EOFError
EOFError
                                                                                </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+----------------+
|          clean_body|controversiality|
+--------------------+----------------+
|get man but that ...|               0|
|nose putty and co...|               0|
|noticed the scar ...|               0|
|switch between cl...|               0|
|hope this helps t...|               0|
|dude the first th...|               0|
|that scar fuckin ...|               0|
|would try retin w...|               0|
|damn this looks l...|               0|
|and then someone ...|               0|
|didnt notice the ...|               0|
| its pretty dope man|               0|
|gives your face c...|               0|
|fuck that show th...|               0|
|and then someone ...|               0|
|man looks like re...|               0|
|you remind geralt...|               0|
|dude the first th...|               0|
|    awesome scar tho|               0|
|mean think looks ...|               0|
+--------------------+----------------+
only showing top 20 rows
</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="56">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>Contro_dataset<span class="op">=</span>Contro_dataset.toPandas()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>                                                                                </code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="57">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>Contro_dataset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">clean_body</th>
<th data-quarto-table-cell-role="th">controversiality</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>get man but that badass scar own brother</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>nose putty and concealer</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>noticed the scar but looks cool</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>switch between clean amp clear dual action and...</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>hope this helps this guy awesome knows his stuff</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">104482</td>
<td>love this pretty</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">104483</td>
<td>thanks nipples are medium brown and lips are p...</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">104484</td>
<td>dont follow her but know her mua use use lot m...</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">104485</td>
<td>you are pretty</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">104486</td>
<td>deleted</td>
<td>0</td>
</tr>
</tbody>
</table>

<p>104487 rows × 2 columns</p>
</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="58">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'controversiality' column to categorical</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>Contro_dataset[<span class="st">'controversiality'</span>] <span class="op">=</span> Contro_dataset[<span class="st">'controversiality'</span>].astype(<span class="st">'category'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="split-the-controverisality-dataset" class="level3">
<h3 class="anchored" data-anchor-id="split-the-controverisality-dataset">Split the Controverisality Dataset</h3>
<div class="cell" data-tags="[]" data-execution_count="59">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into features (X) and labels (y)</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> Contro_dataset[<span class="st">'clean_body'</span>].tolist()  <span class="co"># Convert to a list</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> Contro_dataset[<span class="st">'controversiality'</span>].tolist()  <span class="co"># Convert to a list</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into training and testing sets</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the test_size parameter to control the ratio of the split</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Now you can use X_train and y_train for training your model</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># And X_test and y_test for evaluating the model</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>train_data <span class="op">=</span> pd.DataFrame({<span class="st">'clean_body'</span>: X_train, <span class="st">'controversiality'</span>: y_train})</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>test_data <span class="op">=</span> pd.DataFrame({<span class="st">'clean_body'</span>: X_test, <span class="st">'controversiality'</span>: y_test})</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="79">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(train_data.describe())</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(test_data.describe())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       controversiality
count      83589.000000
mean           0.009870
std            0.098856
min            0.000000
25%            0.000000
50%            0.000000
75%            0.000000
max            1.000000
       controversiality
count      20898.000000
mean           0.009092
std            0.094919
min            0.000000
25%            0.000000
50%            0.000000
75%            0.000000
max            1.000000</code></pre>
</div>
</div>
</section>
<section id="naive-bayes" class="level3">
<h3 class="anchored" data-anchor-id="naive-bayes">NaiVe Bayes</h3>
<div class="cell" data-tags="[]" data-execution_count="60">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import necessary libraries</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> TfidfVectorizer</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.naive_bayes <span class="im">import</span> MultinomialNB</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report, accuracy_score</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">#  Create a pipeline with a TF-IDF vectorizer and a classifier (e.g., Naive Bayes)</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>text_clf <span class="op">=</span> Pipeline([</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'tfidf'</span>, TfidfVectorizer()),</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'clf'</span>, MultinomialNB())</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co">#  Train the model on the training data</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>text_clf.fit(train_data[<span class="st">'clean_body'</span>], train_data[<span class="st">'controversiality'</span>])</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co">#  Make predictions on the test data</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> text_clf.predict(test_data[<span class="st">'clean_body'</span>])</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate the model performance</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> accuracy_score(test_data[<span class="st">'controversiality'</span>], predictions)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Accuracy: </span><span class="sc">{</span>accuracy<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co"># print a classification report for more detailed metrics</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(test_data[<span class="st">'controversiality'</span>], predictions))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy: 0.99
              precision    recall  f1-score   support

           0       0.99      1.00      1.00     20708
           1       0.00      0.00      0.00       190

    accuracy                           0.99     20898
   macro avg       0.50      0.50      0.50     20898
weighted avg       0.98      0.99      0.99     20898
</code></pre>
</div>
</div>
</section>
<section id="svm" class="level3">
<h3 class="anchored" data-anchor-id="svm">SVM</h3>
<div class="cell" data-tags="[]" data-execution_count="61">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>svm_clf <span class="op">=</span> Pipeline([</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'tfidf'</span>, TfidfVectorizer()),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'clf'</span>, SVC())</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>svm_clf.fit(train_data[<span class="st">'clean_body'</span>], train_data[<span class="st">'controversiality'</span>])</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>predictions_svm <span class="op">=</span> svm_clf.predict(test_data[<span class="st">'clean_body'</span>])</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>accuracy_svm <span class="op">=</span> accuracy_score(test_data[<span class="st">'controversiality'</span>], predictions_svm)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"SVM Accuracy: </span><span class="sc">{</span>accuracy_svm<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(test_data[<span class="st">'controversiality'</span>], predictions_svm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>SVM Accuracy: 0.99
              precision    recall  f1-score   support

           0       0.99      1.00      1.00     20708
           1       0.00      0.00      0.00       190

    accuracy                           0.99     20898
   macro avg       0.50      0.50      0.50     20898
weighted avg       0.98      0.99      0.99     20898
</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/opt/conda/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1308: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/opt/conda/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1308: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))
/opt/conda/lib/python3.10/site-packages/sklearn/metrics/_classification.py:1308: UndefinedMetricWarning: Precision and F-score are ill-defined and being set to 0.0 in labels with no predicted samples. Use `zero_division` parameter to control this behavior.
  _warn_prf(average, modifier, msg_start, len(result))</code></pre>
</div>
</div>
</section>
<section id="random-forest" class="level3">
<h3 class="anchored" data-anchor-id="random-forest">Random Forest</h3>
<div class="cell" data-tags="[]" data-execution_count="62">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>rf_clf <span class="op">=</span> Pipeline([</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'tfidf'</span>, TfidfVectorizer()),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'clf'</span>, RandomForestClassifier())</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>rf_clf.fit(train_data[<span class="st">'clean_body'</span>], train_data[<span class="st">'controversiality'</span>])</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>predictions_rf <span class="op">=</span> rf_clf.predict(test_data[<span class="st">'clean_body'</span>])</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>accuracy_rf <span class="op">=</span> accuracy_score(test_data[<span class="st">'controversiality'</span>], predictions_rf)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Random Forest Accuracy: </span><span class="sc">{</span>accuracy_rf<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(test_data[<span class="st">'controversiality'</span>], predictions_rf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Random Forest Accuracy: 0.99
              precision    recall  f1-score   support

           0       0.99      1.00      1.00     20708
           1       0.00      0.00      0.00       190

    accuracy                           0.99     20898
   macro avg       0.50      0.50      0.50     20898
weighted avg       0.98      0.99      0.99     20898
</code></pre>
</div>
</div>
<p>The Three model all show the same result ,Therefore I choose to Show it in One Page</p>
<div class="cell" data-tags="[]" data-execution_count="79">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> TfidfVectorizer</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, classification_report, confusion_matrix, roc_curve, auc</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotly.subplots <span class="im">import</span> make_subplots</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the ROC curve</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>y_true <span class="op">=</span> test_data[<span class="st">'controversiality'</span>]</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>y_scores <span class="op">=</span> rf_clf.predict_proba(test_data[<span class="st">'clean_body'</span>])[:, <span class="dv">1</span>]  <span class="co"># Probability of class 1</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>fpr, tpr, thresholds <span class="op">=</span> roc_curve(y_true, y_scores)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>roc_auc <span class="op">=</span> auc(fpr, tpr)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate confusion matrix</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="op">=</span> confusion_matrix(y_true, predictions_rf)</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ROC Curve and Confusion Matrix with Plotly</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> make_subplots(rows<span class="op">=</span><span class="dv">1</span>, cols<span class="op">=</span><span class="dv">2</span>, subplot_titles<span class="op">=</span>[<span class="st">'Receiver Operating Characteristic (ROC) Curve'</span>, <span class="st">'Confusion Matrix'</span>])</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC Curve</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>fig.add_trace(go.Scatter(x<span class="op">=</span>fpr, y<span class="op">=</span>tpr, mode<span class="op">=</span><span class="st">'lines'</span>, name<span class="op">=</span><span class="st">'ROC curve (area = </span><span class="sc">{:.2f}</span><span class="st">)'</span>.<span class="bu">format</span>(roc_auc)),</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>              row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>fig.add_trace(go.Scatter(x<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>], y<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>], mode<span class="op">=</span><span class="st">'lines'</span>, name<span class="op">=</span><span class="st">'Random'</span>, line<span class="op">=</span><span class="bu">dict</span>(dash<span class="op">=</span><span class="st">'dash'</span>)),</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>              row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>fig.update_xaxes(title_text<span class="op">=</span><span class="st">'False Positive Rate'</span>, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>fig.update_yaxes(title_text<span class="op">=</span><span class="st">'True Positive Rate'</span>, row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion Matrix</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>fig.add_trace(go.Heatmap(z<span class="op">=</span>conf_matrix, colorscale<span class="op">=</span><span class="st">'Viridis'</span>, showscale<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>              row<span class="op">=</span><span class="dv">1</span>, col<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>fig.update_layout(title_text<span class="op">=</span><span class="st">' Result of Prediction '</span>)</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the combined figure</span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>save_path <span class="op">=</span> <span class="st">'/root/fall-2023-reddit-project-team-33/data/plots/RF_ROC_ConfusionMatrix.html'</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>fig.write_html(save_path)</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="d9e89a6c-9e0f-45b4-a74c-30581f52789f" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("d9e89a6c-9e0f-45b4-a74c-30581f52789f")) {                    Plotly.newPlot(                        "d9e89a6c-9e0f-45b4-a74c-30581f52789f",                        [{"mode":"lines","name":"ROC curve (area = 0.56)","x":[0.0,4.829051574270813e-05,0.00019316206297083252,0.0003380336101989569,0.0005311956731697895,0.0006277767046552057,0.0009658103148541626,0.001110681862082287,0.0012072628935677033,0.0013038439250531197,0.0014970059880239522,0.0016901680509947847,0.0017384585667374927,0.0018833301139656172,0.0020764921769364495,0.0023662352713926986,0.0024628163028781146,0.0026559783658489473,0.002897430944562488,0.0030905930075333203,0.0032354645547614446,0.0034286266177322774,0.0034769171334749853,0.0035734981649604017,0.0037666602279312345,0.0041046938381301915,0.004152984353872899,0.004152984353872899,0.004346146416843732,0.004442727448329148,0.004780761058528105,0.005215375700212479,0.005988023952095809,0.006132895499323933,0.006181186015066641,0.007098705814178095,0.007195286845663512,0.00724357736140622,0.008064516129032258,0.009126907475371837,0.00932006953834267,0.009416650569828086,0.009513231601313501,0.009609812632798918,0.010527332431910372,0.01062391346339579,0.010817075526366621,0.010913656557852038,0.012555534093104115,0.012700405640332238,0.013135020282016612,0.013328182344987444,0.015404674521923895,0.015887579679350977,0.016129032258064516,0.01627390380529264,0.01632219432103535,0.018446977013714505,0.01864013907668534,0.02124782692679158,0.021296117442534287,0.02148927950550512,0.021537570021247825,0.0219721846629322,0.022358508788873865,0.022648251883330115,0.028298242225226967,0.028346532740969675,0.028491404288197797,0.028539694803940505,0.028781147382654047,0.028829437898396756,0.02916747150859571,0.02950550511879467,0.029795248213250917,0.029843538728993625,0.03877728414139463,0.038873865172880044,0.039163608267336295,0.03926018929882171,0.03950164187753525,0.039743094456248795,0.040370871160904,0.04051574270813212,0.04090206683407379,0.041095228897044624,0.04128839096001545,0.04201274869615607,0.04230249179061232,0.04322001158972378,0.05901101023758934,0.059059300753332045,0.05915588178481746,0.05930075333204558,0.05978365848947267,0.059880239520958084,0.08025883716438091,0.08035541819586633,0.08098319490052154,0.08117635696349237,0.08146610005794862,0.08161097160517675,0.08165926212091945,0.08238361985706007,0.08262507243577362,0.08272165346725903,0.08305968707745799,0.0867297662739038,0.08682634730538923,0.08692292833687464,0.12854935290708905,0.1295151632219432,0.12961174425342864,0.12970832528491405,0.12975661580065675,0.12994977786362757,0.12999806837937028,0.1317848174618505,0.13192968900907862,0.13197797952482132,0.13275062777670465,0.13313695190264632,0.1585377631833108,0.15863434421479622,0.15882750627776704,0.1592138304037087,0.15940699246667955,0.15960015452965037,0.15969673556113578,0.15984160710836393,0.16080741742321808,0.16085570793896078,0.16129032258064516,0.1614351941278733,0.16312536217886808,0.1632219432103535,0.1633668147575816,0.16351168630480972,0.16355997682055246,0.1675197991114545,0.16761638014293992,0.16853389994205137,0.1686787714892795,0.16877535252076492,0.16892022406799304,0.16901680509947847,0.16911338613096388,0.1692099671624493,0.17210739810701178,0.3059687077457987,0.3060652887772841,0.3061618698087696,0.3064999034189685,0.30659648445045395,0.30669306548193936,0.3068862275449102,0.30693451806065286,0.30712768012362374,0.30712768012362374,0.30732084218659456,0.30741742321807997,0.3075140042495654,0.3086729766273904,0.3087695576588758,0.3088661386903612,0.3090110102375893,0.30925246281630286,0.309397334363531,0.3101216920996716,0.31026656364689975,0.3106528877728414,0.31084604983581227,0.3114255360247247,0.31152211705621013,0.3116186980876956,0.3117635696349237,0.3118601506664091,0.3118601506664091,0.31200502221363724,0.31219818427660806,0.33397720687656945,0.33402549739231213,0.33412207842379754,0.3343635310025111,0.3344601120339965,0.33460498358122465,0.3347498551284528,0.3348464361599382,0.33513617925439443,0.33518446977013716,0.33528105080162257,0.335377631833108,0.3354742128645934,0.33561908441182153,0.33581224647479235,0.3358605369905351,0.3358605369905351,0.33590882750627776,0.3361019895692486,0.3361502800849913,0.33634344214796214,0.33653660421093295,0.3366814757581611,0.33682634730538924,0.33692292833687465,0.3369712188526173,0.33711609039984547,0.337695576588758,0.3378887386517288,0.3379853196832142,0.33817848174618503,0.3384682248406413,0.3386130963878694,0.3387096774193548,1.0],"y":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.010526315789473684,0.010526315789473684,0.010526315789473684,0.010526315789473684,0.010526315789473684,0.010526315789473684,0.010526315789473684,0.015789473684210527,0.015789473684210527,0.015789473684210527,0.021052631578947368,0.021052631578947368,0.021052631578947368,0.021052631578947368,0.021052631578947368,0.021052631578947368,0.021052631578947368,0.021052631578947368,0.021052631578947368,0.021052631578947368,0.021052631578947368,0.021052631578947368,0.021052631578947368,0.021052631578947368,0.021052631578947368,0.021052631578947368,0.021052631578947368,0.02631578947368421,0.02631578947368421,0.02631578947368421,0.02631578947368421,0.031578947368421054,0.031578947368421054,0.031578947368421054,0.031578947368421054,0.031578947368421054,0.031578947368421054,0.031578947368421054,0.031578947368421054,0.031578947368421054,0.04736842105263158,0.04736842105263158,0.04736842105263158,0.04736842105263158,0.04736842105263158,0.04736842105263158,0.04736842105263158,0.04736842105263158,0.04736842105263158,0.04736842105263158,0.04736842105263158,0.04736842105263158,0.04736842105263158,0.04736842105263158,0.04736842105263158,0.04736842105263158,0.04736842105263158,0.04736842105263158,0.04736842105263158,0.05263157894736842,0.05263157894736842,0.05263157894736842,0.05263157894736842,0.05789473684210526,0.05789473684210526,0.05789473684210526,0.05789473684210526,0.05789473684210526,0.06315789473684211,0.06315789473684211,0.06315789473684211,0.06315789473684211,0.06315789473684211,0.08947368421052632,0.08947368421052632,0.08947368421052632,0.08947368421052632,0.08947368421052632,0.08947368421052632,0.1631578947368421,0.1631578947368421,0.1631578947368421,0.1631578947368421,0.1631578947368421,0.1631578947368421,0.1631578947368421,0.1631578947368421,0.1631578947368421,0.1631578947368421,0.1631578947368421,0.1631578947368421,0.16842105263157894,0.16842105263157894,0.21578947368421053,0.21578947368421053,0.21578947368421053,0.21578947368421053,0.21578947368421053,0.21578947368421053,0.21578947368421053,0.22105263157894736,0.22105263157894736,0.22105263157894736,0.22105263157894736,0.22105263157894736,0.26842105263157895,0.26842105263157895,0.26842105263157895,0.26842105263157895,0.26842105263157895,0.26842105263157895,0.26842105263157895,0.26842105263157895,0.26842105263157895,0.26842105263157895,0.26842105263157895,0.26842105263157895,0.2789473684210526,0.2789473684210526,0.2789473684210526,0.2789473684210526,0.2789473684210526,0.28421052631578947,0.28421052631578947,0.28421052631578947,0.28421052631578947,0.28421052631578947,0.28421052631578947,0.28421052631578947,0.28421052631578947,0.28421052631578947,0.29473684210526313,0.4105263157894737,0.4105263157894737,0.4105263157894737,0.4105263157894737,0.4105263157894737,0.4105263157894737,0.4105263157894737,0.4105263157894737,0.4105263157894737,0.41578947368421054,0.41578947368421054,0.41578947368421054,0.41578947368421054,0.41578947368421054,0.41578947368421054,0.41578947368421054,0.41578947368421054,0.41578947368421054,0.41578947368421054,0.41578947368421054,0.41578947368421054,0.41578947368421054,0.41578947368421054,0.41578947368421054,0.41578947368421054,0.41578947368421054,0.41578947368421054,0.41578947368421054,0.42105263157894735,0.42105263157894735,0.42105263157894735,0.4263157894736842,0.4263157894736842,0.4263157894736842,0.4263157894736842,0.4263157894736842,0.4263157894736842,0.4263157894736842,0.4263157894736842,0.4263157894736842,0.4263157894736842,0.4263157894736842,0.4263157894736842,0.4263157894736842,0.4263157894736842,0.4263157894736842,0.4263157894736842,0.43157894736842106,0.43157894736842106,0.43157894736842106,0.43157894736842106,0.43157894736842106,0.43157894736842106,0.43157894736842106,0.43157894736842106,0.43157894736842106,0.43157894736842106,0.43157894736842106,0.43157894736842106,0.43157894736842106,0.43157894736842106,0.43157894736842106,0.43157894736842106,0.43157894736842106,0.43157894736842106,1.0],"type":"scatter","xaxis":"x","yaxis":"y"},{"line":{"dash":"dash"},"mode":"lines","name":"Random","x":[0,1],"y":[0,1],"type":"scatter","xaxis":"x","yaxis":"y"},{"colorscale":[[0.0,"#440154"],[0.1111111111111111,"#482878"],[0.2222222222222222,"#3e4989"],[0.3333333333333333,"#31688e"],[0.4444444444444444,"#26828e"],[0.5555555555555556,"#1f9e89"],[0.6666666666666666,"#35b779"],[0.7777777777777778,"#6ece58"],[0.8888888888888888,"#b5de2b"],[1.0,"#fde725"]],"showscale":false,"z":[[20704,4],[190,0]],"type":"heatmap","xaxis":"x2","yaxis":"y2"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"xaxis":{"anchor":"y","domain":[0.0,0.45],"title":{"text":"False Positive Rate"}},"yaxis":{"anchor":"x","domain":[0.0,1.0],"title":{"text":"True Positive Rate"}},"xaxis2":{"anchor":"y2","domain":[0.55,1.0]},"yaxis2":{"anchor":"x2","domain":[0.0,1.0]},"annotations":[{"font":{"size":16},"showarrow":false,"text":"Receiver Operating Characteristic (ROC) Curve","x":0.225,"xanchor":"center","xref":"paper","y":1.0,"yanchor":"bottom","yref":"paper"},{"font":{"size":16},"showarrow":false,"text":"Confusion Matrix","x":0.775,"xanchor":"center","xref":"paper","y":1.0,"yanchor":"bottom","yref":"paper"}],"title":{"text":" Result of Prediction "}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('d9e89a6c-9e0f-45b4-a74c-30581f52789f');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 70:=======================&gt;                              (105 + 2) / 242]</code></pre>
</div>
</div>
</section>
<section id="confusion-matrix-and-roc-curve-analysis" class="level2">
<h2 class="anchored" data-anchor-id="confusion-matrix-and-roc-curve-analysis">Confusion Matrix and ROC Curve Analysis</h2>
<p>This Three models exhibit impressive accuracy of 0.99, primarily driven by its ability to accurately predict instances of the majority class (class 0, non-controversial). However, a deeper analysis through the confusion matrix and ROC curve reveals significant challenges in correctly identifying instances of the minority class (class 1, controversial). The confusion matrix indicates that the model has failed to predict any true positives for the controversial class, resulting in a lack of precision, recall, and F1-score for class 1. The ROC curve, characterized by a diagonal line and an AUC of 0.5, further underscores the model’s struggle to discriminate effectively between the two classes. These findings suggest a need for addressing class imbalance and potentially exploring alternative models or parameter tuning to enhance the Random Forest’s performance, especially in capturing patterns related to the controversial class.</p>
<p>In summary, while the overall accuracy appears impressive, the model’s inability to correctly identify instances of the minority class is a significant limitation. Further refinement, potentially involving class rebalancing techniques or alternative modeling approaches, is recommended to ensure a more balanced and effective predictive performance across both classes in real-world applications.</p>
</section>
<section id="controversiality-text-classification-summary" class="level1">
<h1>Controversiality Text Classification Summary</h1>
<p>The Controversiality text classification model did a great job overall, achieving a super high accuracy of 99%! However, when we take a closer look, there’s a bit more to the story.</p>
<section id="breakdown" class="level2">
<h2 class="anchored" data-anchor-id="breakdown">Breakdown:</h2>
<section id="great-at-easy-questions-non-controversial" class="level3">
<h3 class="anchored" data-anchor-id="great-at-easy-questions-non-controversial">Great at Easy Questions (Non-controversial):</h3>
<ul>
<li>The model aced the questions related to everyday, non-controversial topics. It got 99% of those right!</li>
<li>It’s like the student getting almost every question about everyday life correct.</li>
</ul>
</section>
<section id="struggling-with-difficult-questions-controversial" class="level3">
<h3 class="anchored" data-anchor-id="struggling-with-difficult-questions-controversial">Struggling with Difficult Questions (Controversial):</h3>
<ul>
<li>Now, when it comes to the tricky questions about controversial issues, the model kind of drew a blank. It didn’t get a single one right!</li>
<li>It’s like the student completely missing all the challenging questions on controversial topics.</li>
</ul>
</section>
<section id="overall-grade" class="level3">
<h3 class="anchored" data-anchor-id="overall-grade">Overall Grade:</h3>
<ul>
<li>If we calculate the overall grade for the test, it looks fantastic because the majority of the questions were easy. The model got an A+!</li>
<li>However, if we look closer and see how the student performed on the tough questions, it’s not so great.</li>
</ul>
</section>
</section>
<section id="in-a-nutshell" class="level2">
<h2 class="anchored" data-anchor-id="in-a-nutshell">In a Nutshell:</h2>
<ul>
<li>The model is like a superstar when it comes to everyday stuff but needs some serious help understanding controversial topics.</li>
<li>So, while the overall grade looks impressive, it’s important to remember that there’s room for improvement, especially in dealing with the more challenging, controversial aspects.</li>
</ul>
</section>
<section id="suggestions-for-improvement" class="level2">
<h2 class="anchored" data-anchor-id="suggestions-for-improvement">Suggestions for Improvement:</h2>
<ul>
<li>It might be helpful to give the model more exposure to controversial topics during training, like giving our student more practice with the tougher questions.</li>
<li>The model could benefit from learning different strategies to handle these tricky topics, maybe by considering more factors or using a more sophisticated approach.</li>
<li>Also, we could try to balance the topics in our test to make sure we’re not just testing on the easy stuff.</li>
</ul>
<p>In a nutshell, while the model is a star in some areas, it still has some homework to do when it comes to understanding controversial issues.</p>
</section>
<section id="improvement" class="level2">
<h2 class="anchored" data-anchor-id="improvement">Improvement</h2>
<section id="get-balanced-comments-datasets" class="level3">
<h3 class="anchored" data-anchor-id="get-balanced-comments-datasets">Get Balanced Comments Datasets</h3>
<p>In summary, without a balanced dataset, the models achieved an impressive 99% accuracy in predicting ‘controversiality=False’. However, when it comes to predicting ‘controversiality=True’ comments, the performance is less satisfactory. Therefore, we started from the original dataset, ensuring a total data length not exceeding 10,000. We randomly sampled and merged from the original 834,339 records with ‘controversiality=False’ and 8,563 records with ‘controversiality=True’. Subsequently, we cleaned the text content in the balanced dataset and utilized logistic regression, Naive Bayes, and SVM for prediction. This approach aims to address the imbalanced class issue and enhance the models’ performance.</p>
<div class="cell" data-tags="[]" data-execution_count="6">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>comments.show(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+--------------+----------------------+-----------------+--------------------+--------+----------------+-------------------+-------------+------+------+-------+------------+---------+----------+--------------------+-------------------+-----+--------+---------------+------------+
|              author|author_cakeday|author_flair_css_class|author_flair_text|                body|can_gild|controversiality|        created_utc|distinguished|edited|gilded|     id|is_submitter|  link_id| parent_id|           permalink|       retrieved_on|score|stickied|      subreddit|subreddit_id|
+--------------------+--------------+----------------------+-----------------+--------------------+--------+----------------+-------------------+-------------+------+------+-------+------------+---------+----------+--------------------+-------------------+-----+--------+---------------+------------+
|        chinghiskhan|          null|                00FFFF|       Glitterati|  Aww, thank you! 💙|    true|               0|2022-01-11 04:04:19|         null| false|     0|hs5vt5h|        true|t3_s125dy|t1_hs5p1jj|/r/MakeupAddictio...|2022-02-21 17:59:13|    4|   false|MakeupAddiction|    t5_2rww2|
|        chinghiskhan|          null|                00FFFF|       Glitterati|Aw thanks, that’s...|    true|               0|2022-01-11 04:04:46|         null| false|     0|hs5vv80|        true|t3_s125dy|t1_hs5q3g2|/r/MakeupAddictio...|2022-02-21 17:59:10|    5|   false|MakeupAddiction|    t5_2rww2|
|        chinghiskhan|          null|                00FFFF|       Glitterati|Omg thank you so ...|    true|               0|2022-01-11 04:05:04|         null| false|     0|hs5vwrf|        true|t3_s125dy|t1_hs5r131|/r/MakeupAddictio...|2022-02-21 17:59:08|    5|   false|MakeupAddiction|    t5_2rww2|
|        ssuperficial|          null|                  null|             null|Too Faced had a k...|    true|               0|2022-01-11 04:08:26|         null| false|     0|hs5wdjb|       false|t3_s0u3nh| t3_s0u3nh|/r/MakeupAddictio...|2022-02-21 17:58:42|    2|   false|MakeupAddiction|    t5_2rww2|
|Equivalent-Newt-4592|          null|                  null|             null|All the eyeshadow...|    true|               0|2022-01-11 04:09:07|         null| false|     0|hs5wh9u|        true|t3_s11hyr|t1_hs5p5dn|/r/MakeupAddictio...|2022-02-21 17:58:36|   10|   false|MakeupAddiction|    t5_2rww2|
+--------------------+--------------+----------------------+-----------------+--------------------+--------+----------------+-------------------+-------------+------+------+-------+------------+---------+----------+--------------------+-------------------+-----+--------+---------------+------------+
only showing top 5 rows
</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="12">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#### sample the improve_comments dataset</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>improve_comments <span class="op">=</span> comments.sample(withReplacement<span class="op">=</span><span class="va">False</span>, fraction<span class="op">=</span><span class="fl">0.8</span>, seed<span class="op">=</span><span class="dv">123</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.types <span class="im">import</span> IntegerType</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'controversiality' to integer type (assuming it's not already)</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>improve_comments <span class="op">=</span> improve_comments.withColumn(<span class="st">'controversiality'</span>, improve_comments[<span class="st">'controversiality'</span>].cast(IntegerType()))</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'controversiality' to a categorical variable</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>improve_comments <span class="op">=</span> improve_comments.withColumn(<span class="st">'controversiality'</span>, improve_comments[<span class="st">'controversiality'</span>].cast(<span class="st">'string'</span>))</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the updated DataFrame</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>improve_comments_selected <span class="op">=</span> improve_comments.select(<span class="st">'body'</span>, <span class="st">'controversiality'</span>)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>controversiality_counts <span class="op">=</span> improve_comments_selected.groupBy(<span class="st">'controversiality'</span>).count()</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the count of different controversiality values</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>controversiality_counts.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 5:======================================================&gt;(240 + 1) / 241]                                                                                </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>+----------------+------+
|controversiality| count|
+----------------+------+
|               0|834339|
|               1|  8563|
+----------------+------+
</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="14">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> rand</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly sample 8343 records from samples with controversiality=0</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>controversiality_0_samples <span class="op">=</span> improve_comments.<span class="bu">filter</span>(improve_comments[<span class="st">'controversiality'</span>] <span class="op">==</span> <span class="dv">0</span>).orderBy(rand(seed<span class="op">=</span><span class="dv">42</span>)).limit(<span class="dv">8343</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Select all 8563 records from samples with controversiality=1</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>controversiality_1_samples <span class="op">=</span> improve_comments.<span class="bu">filter</span>(improve_comments[<span class="st">'controversiality'</span>] <span class="op">==</span> <span class="dv">1</span>)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the two subsets</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>balanced_df <span class="op">=</span> controversiality_0_samples.union(controversiality_1_samples)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly sample 10000 records</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>balanced_df <span class="op">=</span> balanced_df.orderBy(rand(seed<span class="op">=</span><span class="dv">42</span>)).limit(<span class="dv">10000</span>)</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the results</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>balanced_df.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 5:======================================================&gt;(241 + 1) / 242]                                                                                </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+--------------+----------------------+-----------------+--------------------+--------+----------------+-------------------+-------------+------+------+-------+------------+----------+----------+--------------------+-------------------+-----+--------+---------------+------------+
|              author|author_cakeday|author_flair_css_class|author_flair_text|                body|can_gild|controversiality|        created_utc|distinguished|edited|gilded|     id|is_submitter|   link_id| parent_id|           permalink|       retrieved_on|score|stickied|      subreddit|subreddit_id|
+--------------------+--------------+----------------------+-----------------+--------------------+--------+----------------+-------------------+-------------+------+------+-------+------------+----------+----------+--------------------+-------------------+-----+--------+---------------+------------+
|         teatalker26|          null|                  null|             null|          no thanks!|    true|               1|2023-03-04 13:15:32|         null| false|     0|javqqnx|        true|t3_11hj0yj|t1_javpj0a|/r/MakeupAddictio...|2023-04-12 11:27:23|    8|   false|MakeupAddiction|    t5_2rww2|
|     Forsaken_Box_94|          null|                  null|             null|I have to confess...|    true|               1|2022-08-15 19:41:28|         null| false|     0|ikf9de7|       false| t3_wp8d81| t3_wp8d81|/r/MakeupAddictio...|2022-09-08 23:25:49|   -2|   false|MakeupAddiction|    t5_2rww2|
|         Waterblooms|          null|                  null|             null|           Gorgeous!|    true|               1|2022-01-31 03:02:19|         null| false|     0|huy0zri|       false| t3_sglylm| t3_sglylm|/r/MakeupAddictio...|2022-02-19 06:20:42|    1|   false|MakeupAddiction|    t5_2rww2|
|       Murky-Ad-8891|          null|                  null|             null|Fragrances are kn...|    true|               1|2022-10-26 10:34:30|         null| false|     0|itu7hg7|       false| t3_ydkcxp|t1_ittajuf|/r/MakeupAddictio...|2022-11-08 06:08:05|   -1|   false|MakeupAddiction|    t5_2rww2|
|          serena-joy|          null|                  null|             null|oh my god wow?? i...|    true|               0|2021-03-14 22:40:21|         null| false|     0|gqycuc9|        true| t3_m3keim|t1_gqxcf3p|/r/MakeupAddictio...|               null|    2|   false|MakeupAddiction|    t5_2rww2|
|           Skomwtfyb|          null|                  null|             null|           Amazing!!|    true|               1|2021-01-18 00:49:30|         null| false|     0|gjo4vqt|       false| t3_kzhad4| t3_kzhad4|/r/MakeupAddictio...|2021-05-19 02:58:47|    2|   false|MakeupAddiction|    t5_2rww2|
| Adventurous_oF-Girl|          null|                  null|             null|I’m pretty sure i...|    true|               0|2023-03-02 00:20:17|         null| false|     0|jak4o8w|       false|t3_11faa71|t3_11faa71|/r/MakeupAddictio...|2023-04-12 15:03:54|    2|   false|MakeupAddiction|    t5_2rww2|
|    valentinasmakeup|          null|                  null|             null|PRODUCTS USED\r  ...|    true|               0|2022-07-27 11:27:30|         null| false|     0|ihu7ai9|       false| t3_w9c6od| t3_w9c6od|/r/MakeupAddictio...|2022-08-06 06:12:19|    1|   false|MakeupAddiction|    t5_2rww2|
|            witchfai|          null|                  null|             null|wdym by brushing ...|    true|               1|2022-08-10 14:39:18|         null| false|     0|ijq2dwm|       false| t3_wkx59o|t1_ijq1kma|/r/MakeupAddictio...|2022-09-09 09:14:01|   -4|   false|MakeupAddiction|    t5_2rww2|
|       Novel_Ad_5698|          null|                  null|             null|You are literally...|    true|               1|2022-03-25 19:44:54|         null| false|     0|i23tnkh|       false| t3_tnv6k6| t3_tnv6k6|/r/MakeupAddictio...|2022-06-20 05:08:03|   -3|   false|MakeupAddiction|    t5_2rww2|
|    chubby_pancakess|          null|                  null|             null|If your eyelashes...|    true|               1|2022-09-05 01:32:15|         null| false|     0|in4othr|       false| t3_x5wws2| t3_x5wws2|/r/MakeupAddictio...|2022-10-07 02:00:52|    0|   false|MakeupAddiction|    t5_2rww2|
|honeybunchesofgoatso|          null|                  null|             null|Seriously how stu...|    true|               0|2023-03-27 23:44:38|         null| false|     0|jdxt0g1|       false|t3_123pj7x|t1_jdvmn12|/r/MakeupAddictio...|2023-04-11 03:11:46|  119|   false|MakeupAddiction|    t5_2rww2|
|           sushe0001|          null|                  null|             null|You have natural,...|    true|               1|2023-01-15 16:46:23|         null| false|     0|j4gq6tv|       false|t3_10ckq3d|t3_10ckq3d|/r/MakeupAddictio...|2023-02-11 21:17:21|    1|   false|MakeupAddiction|    t5_2rww2|
| missblackeyelinerrx|          null|                  null|             null|Colourpop at fore...|    true|               1|2021-02-15 18:33:19|         null| false|     0|gnk4zum|       false| t3_lkjery| t3_lkjery|/r/MakeupAddictio...|               null|    0|   false|MakeupAddiction|    t5_2rww2|
|          Angel_0997|          null|                  null|             null|This is STUNNING ...|    true|               0|2021-08-09 12:01:42|         null| false|     0|h89z7ke|       false| t3_p0yr94| t3_p0yr94|/r/MakeupAddictio...|2022-05-12 16:34:11|    1|   false|MakeupAddiction|    t5_2rww2|
|         KookyKrista|          null|                  null|             null|Aw, thanks! I use...|    true|               0|2022-11-16 19:35:24|         null| false|     0|iwmmb7k|        true| t3_ywxeot|t1_iwm59t8|/r/MakeupAddictio...|2022-12-15 15:27:12|    1|   false|MakeupAddiction|    t5_2rww2|
|      LittleHexWitch|          null|                  null|             null|This is so goood ...|    true|               0|2021-12-12 18:01:50|         null| false|     0|ho9umcx|       false| t3_reueay| t3_reueay|/r/MakeupAddictio...|2022-02-24 07:12:20|    2|   false|MakeupAddiction|    t5_2rww2|
|Sweaty-Discussion-45|          null|                  null|             null|Lancôme concealer...|    true|               0|2021-12-15 04:04:52|         null| false|     0|holqkg0|       false| t3_rgpvfz| t3_rgpvfz|/r/MakeupAddictio...|2022-06-22 12:42:17|    2|   false|MakeupAddiction|    t5_2rww2|
|        Lex-ington22|          null|                  null|             null|The look is amazi...|    true|               1|2023-03-04 18:22:15|         null| false|     0|jaww8p4|       false|t3_11i5vhz|t3_11i5vhz|/r/MakeupAddictio...|2023-04-12 11:05:46|    5|   false|MakeupAddiction|    t5_2rww2|
|      AccordingShoe8|          null|                  null|             null|This is the cutes...|    true|               1|2022-06-14 22:06:52|         null| false|     0|icdt6kj|       false| t3_vc8q0u| t3_vc8q0u|/r/MakeupAddictio...|2022-07-04 04:11:27|   -2|   false|MakeupAddiction|    t5_2rww2|
+--------------------+--------------+----------------------+-----------------+--------------------+--------+----------------+-------------------+-------------+------+------+-------+------------+----------+----------+--------------------+-------------------+-----+--------+---------------+------------+
only showing top 20 rows
</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="16">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> col, regexp_replace, lower</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> lower, col, regexp_replace, udf, length, StringType</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.feature <span class="im">import</span> Tokenizer, StopWordsRemover</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>balanced_df <span class="op">=</span> balanced_df.withColumn(<span class="st">'clean_body'</span>, clean_text_udf(col(<span class="st">'body'</span>)))</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>balanced_df <span class="op">=</span> balanced_df.na.drop(subset<span class="op">=</span>[<span class="st">"clean_body"</span>])</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>balanced_df <span class="op">=</span> balanced_df.<span class="bu">filter</span>(length(col(<span class="st">'clean_body'</span>)) <span class="op">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="17">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>Contro_dataset<span class="op">=</span>balanced_df.select(<span class="st">"clean_body"</span>,<span class="st">"controversiality"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="18">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>Contro_dataset<span class="op">=</span>Contro_dataset.toPandas()</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>                                                                                </code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="91">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> rand</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into features (X) and labels (y)</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> Contro_dataset[<span class="st">'clean_body'</span>].tolist()  <span class="co"># Convert to a list</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> Contro_dataset[<span class="st">'controversiality'</span>].tolist()  <span class="co"># Convert to a list</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data into training and testing sets</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the test_size parameter to control the ratio of the split</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Now  can use X_train and y_train for training your model</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="co"># And X_test and y_test for evaluating the model</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>train_data <span class="op">=</span> pd.DataFrame({<span class="st">'clean_body'</span>: X_train, <span class="st">'controversiality'</span>: y_train})</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>test_data <span class="op">=</span> pd.DataFrame({<span class="st">'clean_body'</span>: X_test, <span class="st">'controversiality'</span>: y_test})</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="16">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Import necessary libraries</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> TfidfVectorizer</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.naive_bayes <span class="im">import</span> MultinomialNB</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report, accuracy_score</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Create a pipeline with a TF-IDF vectorizer and a classifier (e.g., Naive Bayes)</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>text_clf <span class="op">=</span> Pipeline([</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'tfidf'</span>, TfidfVectorizer()),</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'clf'</span>, MultinomialNB())</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Train the model on the training data</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>text_clf.fit(train_data[<span class="st">'clean_body'</span>], train_data[<span class="st">'controversiality'</span>])</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Make predictions on the test data</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> text_clf.predict(test_data[<span class="st">'clean_body'</span>])</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Evaluate the model performance</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>accuracy <span class="op">=</span> accuracy_score(test_data[<span class="st">'controversiality'</span>], predictions)</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Accuracy: </span><span class="sc">{</span>accuracy<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a><span class="co">#  print a classification report for more detailed metrics</span></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(test_data[<span class="st">'controversiality'</span>], predictions))</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy: 0.67
              precision    recall  f1-score   support

           0       0.74      0.56      0.63      1014
           1       0.63      0.79      0.70       965

    accuracy                           0.67      1979
   macro avg       0.68      0.67      0.67      1979
weighted avg       0.68      0.67      0.67      1979
</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="17">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>rf_clf <span class="op">=</span> Pipeline([</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'tfidf'</span>, TfidfVectorizer()),</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'clf'</span>, RandomForestClassifier())</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>rf_clf.fit(train_data[<span class="st">'clean_body'</span>], train_data[<span class="st">'controversiality'</span>])</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>predictions_rf <span class="op">=</span> rf_clf.predict(test_data[<span class="st">'clean_body'</span>])</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>accuracy_rf <span class="op">=</span> accuracy_score(test_data[<span class="st">'controversiality'</span>], predictions_rf)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Random Forest Accuracy: </span><span class="sc">{</span>accuracy_rf<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(test_data[<span class="st">'controversiality'</span>], predictions_rf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Random Forest Accuracy: 0.65
              precision    recall  f1-score   support

           0       0.68      0.58      0.63      1014
           1       0.62      0.71      0.66       965

    accuracy                           0.65      1979
   macro avg       0.65      0.65      0.65      1979
weighted avg       0.65      0.65      0.65      1979
</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="18">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>svm_clf <span class="op">=</span> Pipeline([</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'tfidf'</span>, TfidfVectorizer()),</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'clf'</span>, SVC())</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>svm_clf.fit(train_data[<span class="st">'clean_body'</span>], train_data[<span class="st">'controversiality'</span>])</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>predictions_svm <span class="op">=</span> svm_clf.predict(test_data[<span class="st">'clean_body'</span>])</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>accuracy_svm <span class="op">=</span> accuracy_score(test_data[<span class="st">'controversiality'</span>], predictions_svm)</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"SVM Accuracy: </span><span class="sc">{</span>accuracy_svm<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(test_data[<span class="st">'controversiality'</span>], predictions_svm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>SVM Accuracy: 0.67
              precision    recall  f1-score   support

           0       0.72      0.59      0.65      1014
           1       0.64      0.76      0.70       965

    accuracy                           0.67      1979
   macro avg       0.68      0.68      0.67      1979
weighted avg       0.68      0.67      0.67      1979
</code></pre>
</div>
</div>
</section>
<section id="tuning" class="level3">
<h3 class="anchored" data-anchor-id="tuning">Tuning</h3>
</section>
<section id="multinomialnb" class="level3">
<h3 class="anchored" data-anchor-id="multinomialnb">MultinomialNB</h3>
<div class="cell" data-tags="[]" data-execution_count="20">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV, cross_val_score</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> TfidfVectorizer, CountVectorizer</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.naive_bayes <span class="im">import</span> MultinomialNB</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> FunctionTransformer</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, classification_report</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom text preprocessor function</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> custom_preprocessor(text):</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Your custom preprocessing logic here</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> preprocessed_text</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the pipeline with placeholders for hyperparameters</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline([</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'tfidf'</span>, TfidfVectorizer()),</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'clf'</span>, MultinomialNB())</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the hyperparameters to search</span></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> {</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tfidf__max_df'</span>: (<span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1.0</span>),</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tfidf__min_df'</span>: (<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>),</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tfidf__ngram_range'</span>: ((<span class="dv">1</span>, <span class="dv">1</span>), (<span class="dv">1</span>, <span class="dv">2</span>)),</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'clf__alpha'</span>: (<span class="fl">1e-2</span>, <span class="fl">1e-3</span>, <span class="fl">1e-4</span>),</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">'clf__fit_prior'</span>: [<span class="va">True</span>, <span class="va">False</span>],</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tfidf__max_features'</span>: [<span class="va">None</span>, <span class="dv">5000</span>, <span class="dv">10000</span>, <span class="dv">20000</span>],</span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Use GridSearchCV to find the best combination of hyperparameters</span></span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>grid_search <span class="op">=</span> GridSearchCV(pipeline, parameters, cv<span class="op">=</span><span class="dv">5</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>, verbose<span class="op">=</span><span class="dv">1</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>)</span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>grid_search.fit(train_data[<span class="st">'clean_body'</span>], train_data[<span class="st">'controversiality'</span>])</span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the best hyperparameters</span></span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Best Hyperparameters:"</span>)</span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(grid_search.best_params_)</span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform nested cross-validation</span></span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a>nested_cv_scores <span class="op">=</span> cross_val_score(grid_search, train_data[<span class="st">'clean_body'</span>], train_data[<span class="st">'controversiality'</span>], cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'accuracy'</span>)</span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Nested Cross-Validation Accuracy: </span><span class="sc">{:.2f}</span><span class="st"> (+/- </span><span class="sc">{:.2f}</span><span class="st">)"</span>.<span class="bu">format</span>(nested_cv_scores.mean(), nested_cv_scores.std() <span class="op">*</span> <span class="dv">2</span>))</span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model with the best hyperparameters on the entire training set</span></span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a>best_model <span class="op">=</span> grid_search.best_estimator_</span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a>best_model.fit(train_data[<span class="st">'clean_body'</span>], train_data[<span class="st">'controversiality'</span>])</span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions on the test set using the best model</span></span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a>best_predictions <span class="op">=</span> best_model.predict(test_data[<span class="st">'clean_body'</span>])</span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate the performance of the best model</span></span>
<span id="cb55-51"><a href="#cb55-51" aria-hidden="true" tabindex="-1"></a>best_accuracy <span class="op">=</span> accuracy_score(test_data[<span class="st">'controversiality'</span>], best_predictions)</span>
<span id="cb55-52"><a href="#cb55-52" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best Model Accuracy: </span><span class="sc">{</span>best_accuracy<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb55-53"><a href="#cb55-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-54"><a href="#cb55-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Print a classification report for the best model</span></span>
<span id="cb55-55"><a href="#cb55-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Classification Report for Best Model:"</span>)</span>
<span id="cb55-56"><a href="#cb55-56" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(test_data[<span class="st">'controversiality'</span>], best_predictions))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting 5 folds for each of 432 candidates, totalling 2160 fits
Best Hyperparameters:
{'clf__alpha': 0.001, 'clf__fit_prior': True, 'tfidf__max_df': 0.5, 'tfidf__max_features': 5000, 'tfidf__min_df': 1, 'tfidf__ngram_range': (1, 1)}
Fitting 5 folds for each of 432 candidates, totalling 2160 fits
Fitting 5 folds for each of 432 candidates, totalling 2160 fits
Fitting 5 folds for each of 432 candidates, totalling 2160 fits
Fitting 5 folds for each of 432 candidates, totalling 2160 fits
Fitting 5 folds for each of 432 candidates, totalling 2160 fits
Nested Cross-Validation Accuracy: 0.65 (+/- 0.03)
Best Model Accuracy: 0.66
Classification Report for Best Model:
              precision    recall  f1-score   support

           0       0.75      0.50      0.60      1014
           1       0.61      0.83      0.70       965

    accuracy                           0.66      1979
   macro avg       0.68      0.66      0.65      1979
weighted avg       0.68      0.66      0.65      1979
</code></pre>
</div>
</div>
<p>The machine learning model was fine-tuned using nested cross-validation, resulting in the best hyperparameters. The model achieved an overall accuracy of 66%, with specific settings favoring recall for class 1. While the precision and recall for class 0 were 75% and 50%, respectively, class 1 showed better performance with 61% precision and 83% recall. The model’s F1-score, a balance between precision and recall, was 65%. Overall, there’s room for improvement, particularly in correctly identifying instances of class 0.</p>
</section>
<section id="randomforest" class="level3">
<h3 class="anchored" data-anchor-id="randomforest">RandomForest</h3>
<div class="cell" data-tags="[]" data-execution_count="26">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> TfidfVectorizer</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, classification_report</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the pipeline</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>rf_pipeline <span class="op">=</span> Pipeline([</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'tfidf'</span>, TfidfVectorizer()),</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'clf'</span>, RandomForestClassifier())</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Define hyperparameters to search</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>rf_parameters <span class="op">=</span> {</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tfidf__max_df'</span>: (<span class="fl">0.75</span>, <span class="fl">1.0</span>),</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tfidf__min_df'</span>: (<span class="dv">2</span>, <span class="dv">5</span>),</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tfidf__ngram_range'</span>: ((<span class="dv">1</span>, <span class="dv">1</span>), (<span class="dv">1</span>, <span class="dv">2</span>)),</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tfidf__max_features'</span>: [<span class="dv">5000</span>, <span class="dv">10000</span>],</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'clf__n_estimators'</span>: [<span class="dv">50</span>,<span class="dv">100</span>, <span class="dv">200</span>],</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'clf__max_depth'</span>: [<span class="dv">10</span>, <span class="dv">20</span>],</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'clf__min_samples_split'</span>: [<span class="dv">5</span>, <span class="dv">10</span>],</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'clf__min_samples_leaf'</span>: [<span class="dv">2</span>, <span class="dv">4</span>],</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Use GridSearchCV to find the best combination of hyperparameters</span></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>rf_grid_search <span class="op">=</span> GridSearchCV(rf_pipeline, rf_parameters, cv<span class="op">=</span><span class="dv">5</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>rf_grid_search.fit(train_data[<span class="st">'clean_body'</span>], train_data[<span class="st">'controversiality'</span>])</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the best hyperparameters</span></span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Best Random Forest Hyperparameters:"</span>)</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rf_grid_search.best_params_)</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the best model on the entire training set</span></span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>best_rf_model <span class="op">=</span> rf_grid_search.best_estimator_</span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>best_rf_model.fit(train_data[<span class="st">'clean_body'</span>], train_data[<span class="st">'controversiality'</span>])</span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate model performance</span></span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a>best_predictions_rf <span class="op">=</span> best_rf_model.predict(test_data[<span class="st">'clean_body'</span>])</span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a>best_accuracy_rf <span class="op">=</span> accuracy_score(test_data[<span class="st">'controversiality'</span>], best_predictions_rf)</span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best Random Forest Model Accuracy: </span><span class="sc">{</span>best_accuracy_rf<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Print a classification report</span></span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Classification Report for Best Random Forest Model:"</span>)</span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(test_data[<span class="st">'controversiality'</span>], best_predictions_rf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting 5 folds for each of 384 candidates, totalling 1920 fits
Best Random Forest Hyperparameters:
{'clf__max_depth': 20, 'clf__min_samples_leaf': 2, 'clf__min_samples_split': 10, 'clf__n_estimators': 200, 'tfidf__max_df': 1.0, 'tfidf__max_features': 10000, 'tfidf__min_df': 5, 'tfidf__ngram_range': (1, 1)}
Best Random Forest Model Accuracy: 0.66
Classification Report for Best Random Forest Model:
              precision    recall  f1-score   support

           0       0.77      0.49      0.60      1014
           1       0.61      0.84      0.71       965

    accuracy                           0.66      1979
   macro avg       0.69      0.67      0.65      1979
weighted avg       0.69      0.66      0.65      1979
</code></pre>
</div>
</div>
<p>The random forest model was optimized with hyperparameter tuning, resulting in the best configuration: max_depth of 20, min_samples_leaf of 2, min_samples_split of 10, and 200 estimators. Additionally, TF-IDF vectorizer settings were identified as follows: max_df of 1.0, max_features of 10,000, min_df of 5, and ngram_range of (1, 1). The model achieved an accuracy of 66%.</p>
<p>Breaking down the classification report for the best random forest model, precision for class 0 was 77%, with a recall of 49% and an F1-score of 60%. For class 1, precision was 61%, recall was 84%, and the F1-score was 71%. The macro-average F1-score was 65%. In summary, the model performed reasonably well, particularly in correctly identifying instances of class 1. However, there’s room for improvement, especially in enhancing recall for class 0.</p>
</section>
<section id="svm-1" class="level3">
<h3 class="anchored" data-anchor-id="svm-1">SVM</h3>
<div class="cell" data-tags="[]" data-execution_count="16">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> TfidfVectorizer</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, classification_report</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the pipeline</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>svm_pipeline <span class="op">=</span> Pipeline([</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'tfidf'</span>, TfidfVectorizer()),</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'clf'</span>, SVC())</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Define hyperparameters to search</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>svm_parameters <span class="op">=</span> {</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tfidf__max_df'</span>: [<span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">1.0</span>],</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tfidf__min_df'</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>],</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tfidf__ngram_range'</span>: [(<span class="dv">1</span>, <span class="dv">1</span>), (<span class="dv">1</span>, <span class="dv">2</span>)],</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'clf__C'</span>: [<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>],</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'clf__kernel'</span>: [<span class="st">'linear'</span>, <span class="st">'rbf'</span>],</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'clf__gamma'</span>: [<span class="st">'scale'</span>, <span class="st">'auto'</span>],</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Use GridSearchCV to find the best hyperparameters</span></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>svm_grid_search <span class="op">=</span> GridSearchCV(svm_pipeline, svm_parameters, cv<span class="op">=</span><span class="dv">5</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>svm_grid_search.fit(train_data[<span class="st">'clean_body'</span>], train_data[<span class="st">'controversiality'</span>])</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the best hyperparameters</span></span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Best SVM Hyperparameters:"</span>)</span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(svm_grid_search.best_params_)</span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the best model on the entire training set</span></span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>best_svm_model <span class="op">=</span> svm_grid_search.best_estimator_</span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>best_svm_model.fit(train_data[<span class="st">'clean_body'</span>], train_data[<span class="st">'controversiality'</span>])</span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate model performance</span></span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a>best_predictions_svm <span class="op">=</span> best_svm_model.predict(test_data[<span class="st">'clean_body'</span>])</span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a>best_accuracy_svm <span class="op">=</span> accuracy_score(test_data[<span class="st">'controversiality'</span>], best_predictions_svm)</span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best SVM Model Accuracy: </span><span class="sc">{</span>best_accuracy_svm<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Print a classification report</span></span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Classification Report for Best SVM Model:"</span>)</span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(test_data[<span class="st">'controversiality'</span>], best_predictions_svm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fitting 5 folds for each of 216 candidates, totalling 1080 fits
Best SVM Hyperparameters:
{'clf__C': 1, 'clf__gamma': 'scale', 'clf__kernel': 'rbf', 'tfidf__max_df': 0.5, 'tfidf__min_df': 1, 'tfidf__ngram_range': (1, 1)}
Best SVM Model Accuracy: 0.67
Classification Report for Best SVM Model:
              precision    recall  f1-score   support

           0       0.72      0.59      0.65      1014
           1       0.64      0.76      0.70       965

    accuracy                           0.67      1979
   macro avg       0.68      0.68      0.67      1979
weighted avg       0.68      0.67      0.67      1979
</code></pre>
</div>
</div>
</section>
<section id="save-the-best-model" class="level3">
<h3 class="anchored" data-anchor-id="save-the-best-model">Save the Best Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> joblib</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the best SVM model to a file</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>model_save_path <span class="op">=</span> <span class="st">'/root/fall-2023-reddit-project-team-33/code/best_svm_model.joblib'</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>joblib.dump(best_svm_model, model_save_path)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best SVM model saved to </span><span class="sc">{</span>model_save_path<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-the-best-model" class="level3">
<h3 class="anchored" data-anchor-id="load-the-best-model">Load the best model</h3>
<div class="cell" data-tags="[]" data-execution_count="92">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> joblib</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the saved SVM model from the file</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>best_svm_model <span class="op">=</span> joblib.load(<span class="st">'/root/fall-2023-reddit-project-team-33/code/ML/best_svm_model.joblib'</span>)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="93">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.feature_extraction.text <span class="im">import</span> TfidfVectorizer</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, classification_report</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate model performance</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>best_predictions_svm <span class="op">=</span> best_svm_model.predict(test_data[<span class="st">'clean_body'</span>])</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>best_accuracy_svm <span class="op">=</span> accuracy_score(test_data[<span class="st">'controversiality'</span>], best_predictions_svm)</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Best SVM Model Accuracy: </span><span class="sc">{</span>best_accuracy_svm<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print a classification report</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Classification Report for Best SVM Model:"</span>)</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(test_data[<span class="st">'controversiality'</span>], best_predictions_svm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Best SVM Model Accuracy: 0.67
Classification Report for Best SVM Model:
              precision    recall  f1-score   support

           0       0.72      0.59      0.65      1014
           1       0.64      0.76      0.70       965

    accuracy                           0.67      1979
   macro avg       0.68      0.68      0.67      1979
weighted avg       0.68      0.67      0.67      1979
</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="94">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(test_data[<span class="st">'controversiality'</span>], best_predictions_svm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="96">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_curve, auc</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co">#test_data and best_svm_model are defined</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert string labels to numerical format</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>test_data[<span class="st">'controversiality'</span>] <span class="op">=</span> test_data[<span class="st">'controversiality'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to plot ROC curve using Plotly</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_roc_curve_plotly(y_true, y_scores, subplot_title):</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>    fpr, tpr, _ <span class="op">=</span> roc_curve(y_true, y_scores)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>    roc_auc <span class="op">=</span> auc(fpr, tpr)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the contrast line (diagonal line)</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    contrast_line_x <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>    contrast_line_y <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> go.Figure()</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(go.Scatter(x<span class="op">=</span>fpr, y<span class="op">=</span>tpr, mode<span class="op">=</span><span class="st">'lines'</span>, name<span class="op">=</span><span class="ss">f'ROC curve (area = </span><span class="sc">{</span>roc_auc<span class="sc">:.2f}</span><span class="ss">)'</span>))</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(go.Scatter(x<span class="op">=</span>contrast_line_x, y<span class="op">=</span>contrast_line_y, mode<span class="op">=</span><span class="st">'lines'</span>, name<span class="op">=</span><span class="st">'Contrast Line'</span>, line<span class="op">=</span>{<span class="st">'dash'</span>: <span class="st">'dot'</span>}))</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>    fig.add_trace(go.Scatter(x<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>], y<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>], mode<span class="op">=</span><span class="st">'lines'</span>, name<span class="op">=</span><span class="st">'Random'</span>, line<span class="op">=</span>{<span class="st">'dash'</span>: <span class="st">'dash'</span>}))</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="ss">f'Receiver Operating Characteristic (ROC) Curve - </span><span class="sc">{</span>subplot_title<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>        xaxis<span class="op">=</span><span class="bu">dict</span>(title<span class="op">=</span><span class="st">'False Positive Rate'</span>),</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>        yaxis<span class="op">=</span><span class="bu">dict</span>(title<span class="op">=</span><span class="st">'True Positive Rate'</span>),</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>        showlegend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the predicted scores for the positive class</span></span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>y_scores_svm <span class="op">=</span> best_svm_model.decision_function(test_data[<span class="st">'clean_body'</span>])</span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Create ROC curve using Plotly</span></span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a>roc_fig <span class="op">=</span> plot_roc_curve_plotly(test_data[<span class="st">'controversiality'</span>], y_scores_svm, <span class="st">'SVM'</span>)</span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Update layout for the figure</span></span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a>roc_fig.update_layout(</span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a>    title_text<span class="op">=</span><span class="st">'ROC Curve of Best SVM Model'</span>,</span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a>    title_x<span class="op">=</span><span class="fl">0.5</span>,  <span class="co"># Center the title</span></span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="bu">dict</span>(x<span class="op">=</span><span class="dv">1</span>, y<span class="op">=</span><span class="dv">1</span>),  <span class="co"># Adjust legend position for the ROC curve subplot</span></span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a>    xaxis_title<span class="op">=</span><span class="st">'False Positive Rate'</span>,</span>
<span id="cb66-44"><a href="#cb66-44" aria-hidden="true" tabindex="-1"></a>    yaxis_title<span class="op">=</span><span class="st">'True Positive Rate'</span>,</span>
<span id="cb66-45"><a href="#cb66-45" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-46"><a href="#cb66-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-47"><a href="#cb66-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the ROC curve plot as an HTML file</span></span>
<span id="cb66-48"><a href="#cb66-48" aria-hidden="true" tabindex="-1"></a>save_path <span class="op">=</span> <span class="st">'/root/fall-2023-reddit-project-team-33/data/plots/BestSVM_ROC.html'</span></span>
<span id="cb66-49"><a href="#cb66-49" aria-hidden="true" tabindex="-1"></a>roc_fig.write_html(save_path)</span>
<span id="cb66-50"><a href="#cb66-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-51"><a href="#cb66-51" aria-hidden="true" tabindex="-1"></a>roc_fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="905b2191-0a50-435d-9c67-94d1a2cd6ce8" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("905b2191-0a50-435d-9c67-94d1a2cd6ce8")) {                    Plotly.newPlot(                        "905b2191-0a50-435d-9c67-94d1a2cd6ce8",                        [{"mode":"lines","name":"ROC curve (area = 0.73)","x":[0.0,0.0,0.0009861932938856016,0.0009861932938856016,0.0019723865877712033,0.0019723865877712033,0.0029585798816568047,0.0029585798816568047,0.005917159763313609,0.005917159763313609,0.006903353057199211,0.006903353057199211,0.007889546351084813,0.007889546351084813,0.009861932938856016,0.009861932938856016,0.010848126232741617,0.010848126232741617,0.011834319526627219,0.011834319526627219,0.015779092702169626,0.015779092702169626,0.016765285996055226,0.016765285996055226,0.01775147928994083,0.01775147928994083,0.01775147928994083,0.01873767258382643,0.01873767258382643,0.01972386587771203,0.020710059171597635,0.020710059171597635,0.021696252465483234,0.021696252465483234,0.022682445759368838,0.023668639053254437,0.023668639053254437,0.02465483234714004,0.02564102564102564,0.05621301775147929,0.05818540433925049,0.05818540433925049,0.05818540433925049,0.07199211045364892,0.07396449704142012,0.07495069033530571,0.07495069033530571,0.07988165680473373,0.08185404339250493,0.08185404339250493,0.08284023668639054,0.08284023668639054,0.08481262327416174,0.08481262327416174,0.08579881656804733,0.08579881656804733,0.08678500986193294,0.08678500986193294,0.08777120315581854,0.08777120315581854,0.08875739644970414,0.08875739644970414,0.09072978303747535,0.09072978303747535,0.09171597633136094,0.09171597633136094,0.09270216962524655,0.09467455621301775,0.09467455621301775,0.09566074950690336,0.09566074950690336,0.09763313609467456,0.09861932938856016,0.09960552268244575,0.09960552268244575,0.10059171597633136,0.10059171597633136,0.10157790927021697,0.10157790927021697,0.10256410256410256,0.10256410256410256,0.10355029585798817,0.10355029585798817,0.10453648915187377,0.10453648915187377,0.10552268244575937,0.10552268244575937,0.10749506903353057,0.10749506903353057,0.10848126232741617,0.10848126232741617,0.10946745562130178,0.10946745562130178,0.11045364891518737,0.11045364891518737,0.11143984220907298,0.11143984220907298,0.11341222879684418,0.11341222879684418,0.11439842209072978,0.11439842209072978,0.11538461538461539,0.11538461538461539,0.11637080867850098,0.11637080867850098,0.11735700197238659,0.11735700197238659,0.11932938856015779,0.11932938856015779,0.1203155818540434,0.1203155818540434,0.12130177514792899,0.12130177514792899,0.126232741617357,0.126232741617357,0.12721893491124261,0.12721893491124261,0.1301775147928994,0.1301775147928994,0.131163708086785,0.131163708086785,0.13214990138067062,0.13214990138067062,0.13313609467455623,0.13313609467455623,0.1351084812623274,0.1351084812623274,0.13708086785009863,0.13708086785009863,0.13806706114398423,0.13806706114398423,0.1390532544378698,0.1390532544378698,0.14003944773175542,0.14003944773175542,0.14102564102564102,0.14102564102564102,0.14398422090729784,0.14398422090729784,0.14497041420118342,0.14497041420118342,0.14595660749506903,0.14595660749506903,0.14792899408284024,0.14792899408284024,0.14891518737672585,0.14891518737672585,0.14891518737672585,0.14990138067061143,0.14990138067061143,0.15187376725838264,0.15187376725838264,0.15285996055226825,0.15285996055226825,0.15384615384615385,0.15384615384615385,0.15581854043392504,0.15581854043392504,0.15877712031558186,0.15877712031558186,0.16074950690335305,0.16074950690335305,0.16272189349112426,0.16272189349112426,0.16469428007889547,0.16469428007889547,0.16666666666666666,0.16666666666666666,0.16765285996055226,0.16765285996055226,0.16863905325443787,0.16863905325443787,0.16962524654832348,0.16962524654832348,0.17061143984220908,0.17061143984220908,0.17159763313609466,0.17159763313609466,0.17357001972386588,0.17455621301775148,0.17455621301775148,0.1755424063116371,0.1755424063116371,0.17850098619329388,0.17850098619329388,0.1794871794871795,0.1794871794871795,0.1804733727810651,0.1804733727810651,0.1814595660749507,0.1814595660749507,0.1844181459566075,0.1844181459566075,0.1854043392504931,0.1854043392504931,0.1873767258382643,0.1873767258382643,0.1883629191321499,0.1883629191321499,0.1893491124260355,0.1893491124260355,0.1913214990138067,0.1913214990138067,0.19230769230769232,0.19230769230769232,0.1932938856015779,0.1932938856015779,0.1942800788954635,0.1942800788954635,0.1952662721893491,0.1952662721893491,0.19723865877712032,0.19723865877712032,0.19822485207100593,0.19822485207100593,0.20019723865877712,0.20019723865877712,0.20118343195266272,0.20118343195266272,0.20315581854043394,0.20315581854043394,0.20414201183431951,0.20414201183431951,0.20512820512820512,0.20512820512820512,0.20611439842209073,0.20611439842209073,0.20808678500986194,0.20808678500986194,0.20907297830374755,0.20907297830374755,0.21104536489151873,0.21104536489151873,0.21301775147928995,0.21301775147928995,0.21400394477317555,0.21400394477317555,0.21499013806706113,0.21499013806706113,0.21597633136094674,0.21597633136094674,0.21893491124260356,0.21893491124260356,0.22090729783037474,0.22090729783037474,0.22287968441814596,0.22287968441814596,0.22583826429980275,0.22583826429980275,0.22781065088757396,0.22781065088757396,0.23076923076923078,0.23076923076923078,0.23274161735700197,0.23274161735700197,0.23372781065088757,0.23372781065088757,0.23471400394477318,0.23471400394477318,0.2357001972386588,0.2357001972386588,0.23668639053254437,0.23668639053254437,0.23767258382642997,0.23767258382642997,0.23964497041420119,0.23964497041420119,0.2406311637080868,0.2406311637080868,0.2445759368836292,0.2445759368836292,0.2455621301775148,0.2455621301775148,0.2465483234714004,0.2465483234714004,0.24753451676528598,0.24753451676528598,0.2514792899408284,0.2514792899408284,0.2534516765285996,0.2534516765285996,0.257396449704142,0.257396449704142,0.2593688362919132,0.2593688362919132,0.2603550295857988,0.2603550295857988,0.2613412228796844,0.2613412228796844,0.26232741617357,0.26232741617357,0.26429980276134124,0.26429980276134124,0.26627218934911245,0.26627218934911245,0.2682445759368836,0.2682445759368836,0.2692307692307692,0.2692307692307692,0.27218934911242604,0.27218934911242604,0.27317554240631164,0.27317554240631164,0.27416173570019725,0.27416173570019725,0.27613412228796846,0.27613412228796846,0.2781065088757396,0.2781065088757396,0.28106508875739644,0.28106508875739644,0.28500986193293887,0.28500986193293887,0.2869822485207101,0.2869822485207101,0.2879684418145957,0.2879684418145957,0.28895463510848124,0.28895463510848124,0.28994082840236685,0.28994082840236685,0.29092702169625245,0.29092702169625245,0.29191321499013806,0.29191321499013806,0.29289940828402367,0.29289940828402367,0.2958579881656805,0.2958579881656805,0.2958579881656805,0.2988165680473373,0.2988165680473373,0.30078895463510846,0.30078895463510846,0.3037475345167653,0.3037475345167653,0.3067061143984221,0.3067061143984221,0.3096646942800789,0.3096646942800789,0.3116370808678501,0.3116370808678501,0.3126232741617357,0.3126232741617357,0.3136094674556213,0.3136094674556213,0.3185404339250493,0.3185404339250493,0.31952662721893493,0.31952662721893493,0.32051282051282054,0.32051282051282054,0.3214990138067061,0.3214990138067061,0.3244575936883629,0.3244575936883629,0.32741617357001973,0.32741617357001973,0.32938856015779094,0.32938856015779094,0.33037475345167655,0.33037475345167655,0.3323471400394477,0.3323471400394477,0.3333333333333333,0.3333333333333333,0.33530571992110453,0.33530571992110453,0.33727810650887574,0.33727810650887574,0.33826429980276135,0.33826429980276135,0.33925049309664695,0.33925049309664695,0.34418145956607493,0.34418145956607493,0.34516765285996054,0.34516765285996054,0.34714003944773175,0.34911242603550297,0.34911242603550297,0.35009861932938857,0.35009861932938857,0.3510848126232742,0.3510848126232742,0.3530571992110454,0.3530571992110454,0.35404339250493094,0.35404339250493094,0.35502958579881655,0.35502958579881655,0.35601577909270216,0.35601577909270216,0.3599605522682446,0.3599605522682446,0.3609467455621302,0.3609467455621302,0.3619329388560158,0.3619329388560158,0.36587771203155817,0.36587771203155817,0.3678500986193294,0.3678500986193294,0.368836291913215,0.368836291913215,0.3708086785009862,0.3708086785009862,0.3727810650887574,0.3727810650887574,0.3757396449704142,0.3757396449704142,0.3767258382642998,0.3767258382642998,0.3777120315581854,0.3777120315581854,0.378698224852071,0.378698224852071,0.3806706114398422,0.3806706114398422,0.38362919132149903,0.38362919132149903,0.38461538461538464,0.38461538461538464,0.3875739644970414,0.3875739644970414,0.388560157790927,0.388560157790927,0.3905325443786982,0.3905325443786982,0.3915187376725838,0.3915187376725838,0.39250493096646943,0.39250493096646943,0.39349112426035504,0.39349112426035504,0.39546351084812625,0.39546351084812625,0.40039447731755423,0.40039447731755423,0.40335305719921105,0.40335305719921105,0.40433925049309666,0.40433925049309666,0.40631163708086787,0.40631163708086787,0.4072978303747535,0.4072978303747535,0.40828402366863903,0.40828402366863903,0.41124260355029585,0.41124260355029585,0.41321499013806706,0.41321499013806706,0.41420118343195267,0.41420118343195267,0.4151873767258383,0.4151873767258383,0.4171597633136095,0.4171597633136095,0.41913214990138065,0.41913214990138065,0.42011834319526625,0.42011834319526625,0.42110453648915186,0.42110453648915186,0.42209072978303747,0.42209072978303747,0.4230769230769231,0.4230769230769231,0.4240631163708087,0.4240631163708087,0.4329388560157791,0.4329388560157791,0.4339250493096647,0.4339250493096647,0.4349112426035503,0.4349112426035503,0.4358974358974359,0.4358974358974359,0.4378698224852071,0.4378698224852071,0.43984220907297833,0.43984220907297833,0.4408284023668639,0.4408284023668639,0.4428007889546351,0.4428007889546351,0.4437869822485207,0.4437869822485207,0.4447731755424063,0.4447731755424063,0.4467455621301775,0.4467455621301775,0.44871794871794873,0.44871794871794873,0.44970414201183434,0.44970414201183434,0.4526627218934911,0.4526627218934911,0.4556213017751479,0.4556213017751479,0.45759368836291914,0.45759368836291914,0.45956607495069035,0.45956607495069035,0.46055226824457596,0.46055226824457596,0.4625246548323471,0.4625246548323471,0.46548323471400394,0.46548323471400394,0.46745562130177515,0.46745562130177515,0.46942800788954636,0.46942800788954636,0.4714003944773176,0.4714003944773176,0.47731755424063116,0.47731755424063116,0.4822485207100592,0.4822485207100592,0.48422090729783035,0.48422090729783035,0.48520710059171596,0.48520710059171596,0.4881656804733728,0.4881656804733728,0.490138067061144,0.490138067061144,0.4921104536489152,0.4921104536489152,0.4940828402366864,0.4940828402366864,0.49506903353057197,0.49506903353057197,0.4970414201183432,0.4970414201183432,0.4990138067061144,0.4990138067061144,0.5,0.5,0.5059171597633136,0.5059171597633136,0.5078895463510849,0.5078895463510849,0.5088757396449705,0.5088757396449705,0.5207100591715976,0.5207100591715976,0.5216962524654832,0.5216962524654832,0.5226824457593688,0.5226824457593688,0.5236686390532544,0.5236686390532544,0.5285996055226825,0.5285996055226825,0.5374753451676528,0.5374753451676528,0.5384615384615384,0.5384615384615384,0.5404339250493096,0.5404339250493096,0.5424063116370809,0.5424063116370809,0.5443786982248521,0.5443786982248521,0.5453648915187377,0.5453648915187377,0.5463510848126233,0.5463510848126233,0.5473372781065089,0.5473372781065089,0.5483234714003945,0.5483234714003945,0.5493096646942801,0.5493096646942801,0.5581854043392505,0.5581854043392505,0.5591715976331361,0.5591715976331361,0.5621301775147929,0.5621301775147929,0.5641025641025641,0.5641025641025641,0.5660749506903353,0.5660749506903353,0.5680473372781065,0.5680473372781065,0.5690335305719921,0.5690335305719921,0.5700197238658777,0.5700197238658777,0.571992110453649,0.571992110453649,0.5729783037475346,0.5729783037475346,0.5759368836291914,0.5759368836291914,0.5779092702169625,0.5779092702169625,0.5798816568047337,0.5798816568047337,0.5808678500986193,0.5808678500986193,0.5838264299802761,0.5838264299802761,0.5848126232741617,0.5848126232741617,0.5867850098619329,0.5867850098619329,0.5877712031558185,0.5877712031558185,0.5897435897435898,0.5897435897435898,0.5907297830374754,0.5907297830374754,0.5936883629191322,0.5936883629191322,0.5946745562130178,0.5946745562130178,0.5956607495069034,0.5956607495069034,0.5976331360946746,0.5976331360946746,0.5986193293885601,0.5986193293885601,0.6094674556213018,0.6094674556213018,0.6104536489151874,0.6104536489151874,0.6173570019723866,0.6173570019723866,0.621301775147929,0.621301775147929,0.6232741617357002,0.6232741617357002,0.6282051282051282,0.6282051282051282,0.6331360946745562,0.6331360946745562,0.636094674556213,0.636094674556213,0.6400394477317555,0.6400394477317555,0.6420118343195266,0.6420118343195266,0.6429980276134122,0.6429980276134122,0.6439842209072978,0.6439842209072978,0.6469428007889546,0.6469428007889546,0.6499013806706114,0.6499013806706114,0.6528599605522682,0.6528599605522682,0.6587771203155819,0.6587771203155819,0.665680473372781,0.665680473372781,0.6666666666666666,0.6666666666666666,0.6686390532544378,0.6686390532544378,0.6715976331360947,0.6715976331360947,0.6755424063116371,0.6755424063116371,0.6775147928994083,0.6775147928994083,0.6804733727810651,0.6804733727810651,0.6903353057199211,0.6903353057199211,0.6913214990138067,0.6913214990138067,0.6923076923076923,0.6923076923076923,0.6952662721893491,0.6952662721893491,0.6962524654832347,0.6962524654832347,0.6972386587771203,0.6972386587771203,0.6992110453648915,0.7001972386587771,0.7071005917159763,0.7071005917159763,0.717948717948718,0.717948717948718,0.7189349112426036,0.7189349112426036,0.7209072978303748,0.7209072978303748,0.7238658777120316,0.7238658777120316,0.7258382642998028,0.7258382642998028,0.7327416173570019,0.7327416173570019,0.7347140039447732,0.7347140039447732,0.7357001972386588,0.7357001972386588,0.73767258382643,0.73767258382643,0.7396449704142012,0.7396449704142012,0.7406311637080868,0.7406311637080868,0.7445759368836292,0.7445759368836292,0.7544378698224852,0.7544378698224852,0.7662721893491125,0.7662721893491125,0.7672583826429981,0.7672583826429981,0.777120315581854,0.777120315581854,0.7790927021696252,0.7790927021696252,0.7800788954635108,0.7800788954635108,0.7850098619329389,0.7850098619329389,0.7879684418145957,0.7879684418145957,0.7919132149901381,0.7919132149901381,0.7998027613412229,0.7998027613412229,0.8106508875739645,0.8106508875739645,0.8175542406311637,0.8175542406311637,0.8214990138067061,0.8214990138067061,0.8244575936883629,0.8284023668639053,0.8303747534516766,0.8925049309664694,0.9142011834319527,0.9240631163708086,0.928007889546351,0.9319526627218935,0.9339250493096647,0.9339250493096647,0.9368836291913215,0.9388560157790927,0.9477317554240631,0.9477317554240631,0.9546351084812623,0.9575936883629191,0.9625246548323472,0.9625246548323472,0.9694280078895463,0.9792899408284024,0.9812623274161736,0.9812623274161736,0.9871794871794872,0.9871794871794872,0.9891518737672583,0.9891518737672583,1.0],"y":[0.0,0.0010362694300518134,0.0010362694300518134,0.004145077720207254,0.004145077720207254,0.010362694300518135,0.010362694300518135,0.021761658031088083,0.021761658031088083,0.022797927461139896,0.022797927461139896,0.03005181347150259,0.03005181347150259,0.03212435233160622,0.03212435233160622,0.03316062176165803,0.03316062176165803,0.035233160621761656,0.035233160621761656,0.03626943005181347,0.03626943005181347,0.03730569948186528,0.03730569948186528,0.0383419689119171,0.0383419689119171,0.049740932642487044,0.05181347150259067,0.05284974093264249,0.0538860103626943,0.05595854922279793,0.05699481865284974,0.06010362694300518,0.06321243523316063,0.06528497409326425,0.07046632124352331,0.07046632124352331,0.07150259067357513,0.07150259067357513,0.07772020725388601,0.12538860103626942,0.12538860103626942,0.12642487046632125,0.1305699481865285,0.20103626943005182,0.20518134715025907,0.20621761658031088,0.20932642487046632,0.21658031088082902,0.21658031088082902,0.22279792746113988,0.22279792746113988,0.23108808290155441,0.23108808290155441,0.23316062176165803,0.23316062176165803,0.23937823834196892,0.23937823834196892,0.24352331606217617,0.24352331606217617,0.25077720207253884,0.25077720207253884,0.25181347150259065,0.25181347150259065,0.2549222797927461,0.2549222797927461,0.25906735751295334,0.25906735751295334,0.261139896373057,0.26424870466321243,0.26424870466321243,0.2704663212435233,0.2704663212435233,0.27253886010362693,0.27253886010362693,0.27357512953367874,0.27357512953367874,0.2756476683937824,0.2756476683937824,0.2766839378238342,0.2766839378238342,0.27979274611398963,0.27979274611398963,0.28082901554404144,0.28082901554404144,0.28186528497409324,0.28186528497409324,0.28290155440414505,0.28290155440414505,0.29430051813471503,0.29430051813471503,0.29637305699481864,0.29637305699481864,0.3005181347150259,0.3005181347150259,0.3015544041450777,0.3015544041450777,0.30259067357512953,0.30259067357512953,0.30466321243523314,0.30466321243523314,0.3088082901554404,0.3088082901554404,0.31088082901554404,0.31088082901554404,0.3150259067357513,0.3150259067357513,0.3160621761658031,0.3160621761658031,0.32746113989637304,0.32746113989637304,0.3305699481865285,0.3305699481865285,0.33678756476683935,0.33678756476683935,0.3378238341968912,0.3378238341968912,0.34093264248704663,0.34093264248704663,0.3450777202072539,0.3450777202072539,0.3461139896373057,0.34922279792746114,0.35544041450777203,0.35544041450777203,0.35647668393782384,0.35647668393782384,0.35958549222797925,0.35958549222797925,0.3606217616580311,0.3606217616580311,0.3616580310880829,0.3616580310880829,0.3626943005181347,0.3626943005181347,0.36373056994818653,0.36373056994818653,0.36787564766839376,0.36787564766839376,0.3699481865284974,0.3699481865284974,0.3761658031088083,0.3761658031088083,0.37927461139896373,0.37927461139896373,0.3854922279792746,0.3854922279792746,0.38652849740932643,0.38860103626943004,0.38860103626943004,0.39378238341968913,0.39378238341968913,0.39896373056994816,0.39896373056994816,0.40103626943005183,0.40103626943005183,0.40207253886010363,0.40207253886010363,0.40310880829015544,0.40310880829015544,0.40414507772020725,0.40414507772020725,0.40621761658031086,0.40621761658031086,0.41658031088082903,0.41658031088082903,0.41968911917098445,0.41968911917098445,0.42072538860103625,0.42072538860103625,0.42694300518134715,0.42694300518134715,0.42901554404145076,0.42901554404145076,0.43005181347150256,0.43005181347150256,0.43316062176165804,0.43316062176165804,0.43419689119170984,0.43419689119170984,0.43419689119170984,0.4383419689119171,0.4383419689119171,0.44041450777202074,0.44041450777202074,0.44559585492227977,0.44559585492227977,0.44766839378238343,0.44766839378238343,0.45284974093264246,0.45284974093264246,0.45803108808290155,0.45803108808290155,0.45906735751295336,0.45906735751295336,0.46010362694300516,0.46010362694300516,0.46735751295336786,0.46735751295336786,0.46839378238341967,0.46839378238341967,0.47150259067357514,0.47150259067357514,0.47253886010362695,0.47253886010362695,0.47461139896373056,0.47461139896373056,0.47668393782383417,0.47668393782383417,0.48082901554404145,0.48082901554404145,0.48186528497409326,0.48186528497409326,0.48497409326424873,0.48497409326424873,0.48601036269430054,0.48601036269430054,0.49119170984455957,0.49119170984455957,0.49430051813471504,0.49430051813471504,0.49740932642487046,0.49740932642487046,0.49844559585492226,0.49844559585492226,0.49948186528497407,0.49948186528497407,0.5025906735751295,0.5025906735751295,0.505699481865285,0.505699481865285,0.5067357512953368,0.5067357512953368,0.5077720207253886,0.5077720207253886,0.5088082901554404,0.5088082901554404,0.5119170984455959,0.5119170984455959,0.5150259067357513,0.5150259067357513,0.5181347150259067,0.5181347150259067,0.5202072538860104,0.5202072538860104,0.5274611398963731,0.5274611398963731,0.5284974093264249,0.5284974093264249,0.5316062176165803,0.5316062176165803,0.5347150259067357,0.5347150259067357,0.5357512953367876,0.5357512953367876,0.5430051813471503,0.5430051813471503,0.5492227979274611,0.5492227979274611,0.5512953367875648,0.5512953367875648,0.5606217616580311,0.5606217616580311,0.5616580310880829,0.5616580310880829,0.5626943005181347,0.5626943005181347,0.5647668393782384,0.5647668393782384,0.5658031088082901,0.5658031088082901,0.5689119170984456,0.5689119170984456,0.5699481865284974,0.5699481865284974,0.5709844559585492,0.5709844559585492,0.572020725388601,0.572020725388601,0.5730569948186528,0.5730569948186528,0.5761658031088083,0.5761658031088083,0.5772020725388601,0.5772020725388601,0.5813471502590674,0.5813471502590674,0.5844559585492228,0.5844559585492228,0.5875647668393782,0.5875647668393782,0.5886010362694301,0.5886010362694301,0.5906735751295337,0.5906735751295337,0.5948186528497409,0.5948186528497409,0.5968911917098445,0.5968911917098445,0.5979274611398964,0.5979274611398964,0.6,0.6,0.6010362694300518,0.6010362694300518,0.6041450777202072,0.6041450777202072,0.6072538860103627,0.6072538860103627,0.6082901554404145,0.6082901554404145,0.6093264248704663,0.6093264248704663,0.6103626943005181,0.6103626943005181,0.6113989637305699,0.6113989637305699,0.6124352331606218,0.6124352331606218,0.616580310880829,0.616580310880829,0.6176165803108808,0.6176165803108808,0.6196891191709845,0.6196891191709845,0.6238341968911917,0.6238341968911917,0.6248704663212435,0.6248704663212435,0.6259067357512953,0.6290155440414508,0.6290155440414508,0.6300518134715026,0.6300518134715026,0.6310880829015544,0.6310880829015544,0.633160621761658,0.633160621761658,0.6341968911917099,0.6341968911917099,0.6373056994818653,0.6373056994818653,0.6404145077720207,0.6404145077720207,0.6414507772020726,0.6414507772020726,0.6435233160621762,0.6435233160621762,0.644559585492228,0.644559585492228,0.6476683937823834,0.6476683937823834,0.6487046632124353,0.6487046632124353,0.6538860103626943,0.6538860103626943,0.6549222797927461,0.6549222797927461,0.661139896373057,0.661139896373057,0.6632124352331606,0.6632124352331606,0.666321243523316,0.666321243523316,0.6704663212435233,0.6704663212435233,0.6735751295336787,0.6735751295336787,0.6746113989637306,0.6746113989637306,0.6766839378238342,0.6766839378238342,0.677720207253886,0.677720207253886,0.6797927461139897,0.6797927461139897,0.6818652849740933,0.6818652849740933,0.6829015544041451,0.6829015544041451,0.6922279792746114,0.6953367875647668,0.6953367875647668,0.6963730569948187,0.6963730569948187,0.6984455958549223,0.6984455958549223,0.7005181347150259,0.7005181347150259,0.7015544041450777,0.7015544041450777,0.7067357512953368,0.7067357512953368,0.7077720207253886,0.7077720207253886,0.7088082901554404,0.7088082901554404,0.7098445595854922,0.7098445595854922,0.7108808290155441,0.7108808290155441,0.7139896373056995,0.7139896373056995,0.7150259067357513,0.7150259067357513,0.7181347150259068,0.7181347150259068,0.7191709844559585,0.7191709844559585,0.7202072538860104,0.7202072538860104,0.7212435233160622,0.7212435233160622,0.7243523316062176,0.7243523316062176,0.7264248704663212,0.7264248704663212,0.7274611398963731,0.7274611398963731,0.7284974093264248,0.7284974093264248,0.7295336787564767,0.7295336787564767,0.7305699481865285,0.7305699481865285,0.7336787564766839,0.7336787564766839,0.7357512953367875,0.7357512953367875,0.7378238341968912,0.7378238341968912,0.738860103626943,0.738860103626943,0.7409326424870466,0.7409326424870466,0.7419689119170985,0.7419689119170985,0.7471502590673575,0.7471502590673575,0.7481865284974093,0.7481865284974093,0.7523316062176166,0.7523316062176166,0.7564766839378239,0.7564766839378239,0.7575129533678756,0.7575129533678756,0.7606217616580311,0.7606217616580311,0.7626943005181347,0.7626943005181347,0.7668393782383419,0.7668393782383419,0.7678756476683938,0.7678756476683938,0.7699481865284974,0.7699481865284974,0.7709844559585493,0.7709844559585493,0.7751295336787565,0.7751295336787565,0.7792746113989637,0.7792746113989637,0.7803108808290156,0.7803108808290156,0.783419689119171,0.783419689119171,0.7844559585492228,0.7844559585492228,0.7854922279792746,0.7854922279792746,0.7865284974093264,0.7865284974093264,0.78860103626943,0.78860103626943,0.7906735751295336,0.7906735751295336,0.7927461139896373,0.7927461139896373,0.7937823834196891,0.7937823834196891,0.794818652849741,0.794818652849741,0.7958549222797927,0.7958549222797927,0.7979274611398963,0.7979274611398963,0.8,0.8,0.805181347150259,0.805181347150259,0.8062176165803109,0.8062176165803109,0.8072538860103627,0.8072538860103627,0.8093264248704664,0.8093264248704664,0.8103626943005181,0.8103626943005181,0.81139896373057,0.81139896373057,0.8124352331606217,0.8124352331606217,0.8145077720207254,0.8145077720207254,0.8155440414507772,0.8155440414507772,0.8176165803108808,0.8176165803108808,0.8186528497409327,0.8186528497409327,0.8196891191709844,0.8196891191709844,0.8217616580310881,0.8217616580310881,0.8227979274611399,0.8227979274611399,0.8248704663212435,0.8248704663212435,0.8259067357512954,0.8259067357512954,0.8269430051813471,0.8269430051813471,0.827979274611399,0.827979274611399,0.8290155440414507,0.8290155440414507,0.8300518134715026,0.8300518134715026,0.8310880829015544,0.8310880829015544,0.8321243523316062,0.8321243523316062,0.8331606217616581,0.8331606217616581,0.8341968911917098,0.8341968911917098,0.8352331606217617,0.8352331606217617,0.8373056994818653,0.8373056994818653,0.8383419689119171,0.8383419689119171,0.8404145077720208,0.8404145077720208,0.8414507772020725,0.8414507772020725,0.8424870466321244,0.8424870466321244,0.8435233160621761,0.8435233160621761,0.844559585492228,0.844559585492228,0.8455958549222798,0.8455958549222798,0.8466321243523316,0.8466321243523316,0.8497409326424871,0.8497409326424871,0.8507772020725388,0.8507772020725388,0.8518134715025907,0.8518134715025907,0.8549222797927462,0.8549222797927462,0.8569948186528498,0.8569948186528498,0.8590673575129534,0.8590673575129534,0.8601036269430051,0.8601036269430051,0.861139896373057,0.861139896373057,0.8621761658031089,0.8621761658031089,0.8642487046632125,0.8642487046632125,0.8663212435233161,0.8663212435233161,0.8673575129533678,0.8673575129533678,0.8683937823834197,0.8683937823834197,0.8704663212435233,0.8704663212435233,0.8715025906735752,0.8715025906735752,0.8725388601036269,0.8725388601036269,0.8735751295336788,0.8735751295336788,0.8756476683937824,0.8756476683937824,0.8766839378238342,0.8766839378238342,0.8787564766839379,0.8787564766839379,0.8797927461139896,0.8797927461139896,0.8829015544041451,0.8829015544041451,0.883937823834197,0.883937823834197,0.8860103626943006,0.8860103626943006,0.8870466321243523,0.8870466321243523,0.8880829015544042,0.8880829015544042,0.8901554404145078,0.8901554404145078,0.8911917098445595,0.8911917098445595,0.8932642487046633,0.8932642487046633,0.894300518134715,0.894300518134715,0.8963730569948186,0.8963730569948186,0.8974093264248705,0.8974093264248705,0.8984455958549222,0.8984455958549222,0.900518134715026,0.900518134715026,0.9036269430051813,0.9036269430051813,0.9056994818652849,0.9056994818652849,0.9067357512953368,0.9067357512953368,0.9088082901554404,0.9088082901554404,0.9119170984455959,0.9119170984455959,0.9129533678756476,0.9129533678756476,0.9139896373056995,0.9139896373056995,0.9150259067357513,0.9150259067357513,0.917098445595855,0.917098445595855,0.9181347150259067,0.9181347150259067,0.9191709844559586,0.9191709844559586,0.9222797927461139,0.9222797927461139,0.9233160621761658,0.9233160621761658,0.9243523316062177,0.9243523316062177,0.9253886010362694,0.9253886010362694,0.927461139896373,0.927461139896373,0.9284974093264249,0.9284974093264249,0.9295336787564766,0.9295336787564766,0.9305699481865285,0.9305699481865285,0.9316062176165804,0.9316062176165804,0.9326424870466321,0.9326424870466321,0.9398963730569948,0.9398963730569948,0.9409326424870467,0.9409326424870467,0.9430051813471503,0.9430051813471503,0.944041450777202,0.944041450777202,0.9450777202072539,0.9450777202072539,0.9481865284974094,0.9481865284974094,0.9492227979274611,0.9492227979274611,0.950259067357513,0.950259067357513,0.9512953367875647,0.9512953367875647,0.9523316062176166,0.9523316062176166,0.9533678756476683,0.9533678756476683,0.9544041450777202,0.9544041450777202,0.9554404145077721,0.9554404145077721,0.9564766839378238,0.9564766839378238,0.9575129533678757,0.9575129533678757,0.9585492227979274,0.9585492227979274,0.9595854922279793,0.9595854922279793,0.960621761658031,0.960621761658031,0.9616580310880829,0.9616580310880829,0.9637305699481865,0.9637305699481865,0.966839378238342,0.966839378238342,0.9678756476683937,0.9678756476683937,0.9689119170984456,0.9689119170984456,0.9699481865284975,0.9699481865284975,0.9709844559585492,0.9709844559585492,0.9720207253886011,0.9720207253886011,0.9730569948186528,0.9730569948186528,0.9761658031088083,0.9761658031088083,0.9782383419689119,0.9782383419689119,0.9792746113989638,0.9792746113989638,0.9803108808290155,0.9803108808290155,0.9813471502590674,0.9813471502590674,0.9823834196891191,0.9823834196891191,0.9844559585492227,0.9844559585492227,0.9865284974093265,0.9865284974093265,0.9875647668393782,0.9875647668393782,0.9886010362694301,0.9886010362694301,0.9886010362694301,0.9906735751295337,0.9906735751295337,0.9927461139896373,0.9927461139896373,0.9927461139896373,0.9927461139896373,0.9927461139896373,0.9937823834196892,0.9937823834196892,0.9937823834196892,0.9937823834196892,0.9948186528497409,0.9948186528497409,0.9948186528497409,0.9948186528497409,0.9958549222797928,0.9958549222797928,0.9958549222797928,0.9958549222797928,0.9968911917098445,0.9968911917098445,0.9989637305699481,0.9989637305699481,1.0,1.0],"type":"scatter"},{"line":{"dash":"dot"},"mode":"lines","name":"Contrast Line","x":[0,1],"y":[0,1],"type":"scatter"},{"line":{"dash":"dash"},"mode":"lines","name":"Random","x":[0,1],"y":[0,1],"type":"scatter"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"title":{"text":"ROC Curve of Best SVM Model","x":0.5},"xaxis":{"title":{"text":"False Positive Rate"}},"yaxis":{"title":{"text":"True Positive Rate"}},"showlegend":true,"legend":{"x":1,"y":1}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('905b2191-0a50-435d-9c67-94d1a2cd6ce8');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="103">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_confusion_matrix_plotly(y_true, y_pred, subplot_title):</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    cm <span class="op">=</span> confusion_matrix(y_true, y_pred).tolist() <span class="co"># Normalizing the confusion matrix</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    x_labels <span class="op">=</span> [<span class="st">'Non-controversial'</span>, <span class="st">'Controversial'</span>]</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    y_labels <span class="op">=</span> [<span class="st">'Non-controversial'</span>, <span class="st">'Controversial'</span>]</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>    z_text <span class="op">=</span> [[<span class="bu">str</span>(value) <span class="cf">for</span> value <span class="kw">in</span> row] <span class="cf">for</span> row <span class="kw">in</span> cm]</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> ff.create_annotated_heatmap(z<span class="op">=</span>cm, x<span class="op">=</span>x_labels, y<span class="op">=</span>y_labels,  annotation_text<span class="op">=</span>z_text,colorscale<span class="op">=</span><span class="st">'Viridis'</span>)</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="ss">f'Confusion Matrix - </span><span class="sc">{</span>subplot_title<span class="sc">}</span><span class="ss">'</span>,</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>        xaxis<span class="op">=</span><span class="bu">dict</span>(title<span class="op">=</span><span class="st">'Predicted'</span>),</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>        yaxis<span class="op">=</span><span class="bu">dict</span>(title<span class="op">=</span><span class="st">'True'</span>),</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add title</span></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(title_text<span class="op">=</span><span class="st">'&lt;i&gt;&lt;b&gt;Confusion matrix&lt;/b&gt;&lt;/i&gt;'</span>,</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>                  <span class="co">#xaxis = dict(title='x'),</span></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>                  <span class="co">#yaxis = dict(title='x')</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>    fig.add_annotation(<span class="bu">dict</span>(font<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"black"</span>,size<span class="op">=</span><span class="dv">14</span>),</span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>                        x<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>                        y<span class="op">=-</span><span class="fl">0.15</span>,</span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>                        showarrow<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>                        text<span class="op">=</span><span class="st">"Predicted value"</span>,</span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>                        xref<span class="op">=</span><span class="st">"paper"</span>,</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>                        yref<span class="op">=</span><span class="st">"paper"</span>))</span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>    fig.add_annotation(<span class="bu">dict</span>(font<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">"black"</span>,size<span class="op">=</span><span class="dv">14</span>),</span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a>                        x<span class="op">=-</span><span class="fl">0.35</span>,</span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a>                        y<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a>                        showarrow<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true" tabindex="-1"></a>                        text<span class="op">=</span><span class="st">"Real value"</span>,</span>
<span id="cb67-34"><a href="#cb67-34" aria-hidden="true" tabindex="-1"></a>                        textangle<span class="op">=-</span><span class="dv">90</span>,</span>
<span id="cb67-35"><a href="#cb67-35" aria-hidden="true" tabindex="-1"></a>                        xref<span class="op">=</span><span class="st">"paper"</span>,</span>
<span id="cb67-36"><a href="#cb67-36" aria-hidden="true" tabindex="-1"></a>                        yref<span class="op">=</span><span class="st">"paper"</span>))</span>
<span id="cb67-37"><a href="#cb67-37" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(margin<span class="op">=</span><span class="bu">dict</span>(t<span class="op">=</span><span class="dv">50</span>, l<span class="op">=</span><span class="dv">200</span>))</span>
<span id="cb67-38"><a href="#cb67-38" aria-hidden="true" tabindex="-1"></a>    fig[<span class="st">'data'</span>][<span class="dv">0</span>][<span class="st">'showscale'</span>] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb67-39"><a href="#cb67-39" aria-hidden="true" tabindex="-1"></a>    fig.show()</span>
<span id="cb67-40"><a href="#cb67-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-41"><a href="#cb67-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb67-42"><a href="#cb67-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-43"><a href="#cb67-43" aria-hidden="true" tabindex="-1"></a>cm_fig<span class="op">=</span>plot_confusion_matrix_plotly(test_data[<span class="st">'controversiality'</span>], y_pred_svm, <span class="st">'SVM'</span>)</span>
<span id="cb67-44"><a href="#cb67-44" aria-hidden="true" tabindex="-1"></a>save_path_cm <span class="op">=</span> <span class="st">'/root/fall-2023-reddit-project-team-33/data/plots/BestSVM_ConfusionMatrix.html'</span></span>
<span id="cb67-45"><a href="#cb67-45" aria-hidden="true" tabindex="-1"></a>cm_fig.write_html(save_path_cm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="151907bc-4bae-4615-819d-beb24190cf40" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("151907bc-4bae-4615-819d-beb24190cf40")) {                    Plotly.newPlot(                        "151907bc-4bae-4615-819d-beb24190cf40",                        [{"colorscale":[[0.0,"#440154"],[0.1111111111111111,"#482878"],[0.2222222222222222,"#3e4989"],[0.3333333333333333,"#31688e"],[0.4444444444444444,"#26828e"],[0.5555555555555556,"#1f9e89"],[0.6666666666666666,"#35b779"],[0.7777777777777778,"#6ece58"],[0.8888888888888888,"#b5de2b"],[1.0,"#fde725"]],"reversescale":false,"showscale":true,"x":["Non-controversial","Controversial"],"y":["Non-controversial","Controversial"],"z":[[600,414],[230,735]],"type":"heatmap"}],                        {"annotations":[{"font":{"color":"#000000"},"showarrow":false,"text":"600","x":"Non-controversial","xref":"x","y":"Non-controversial","yref":"y"},{"font":{"color":"#FFFFFF"},"showarrow":false,"text":"414","x":"Controversial","xref":"x","y":"Non-controversial","yref":"y"},{"font":{"color":"#FFFFFF"},"showarrow":false,"text":"230","x":"Non-controversial","xref":"x","y":"Controversial","yref":"y"},{"font":{"color":"#000000"},"showarrow":false,"text":"735","x":"Controversial","xref":"x","y":"Controversial","yref":"y"},{"font":{"color":"black","size":14},"showarrow":false,"text":"Predicted value","x":0.5,"xref":"paper","y":-0.15,"yref":"paper"},{"font":{"color":"black","size":14},"showarrow":false,"text":"Real value","textangle":-90,"x":-0.35,"xref":"paper","y":0.5,"yref":"paper"}],"xaxis":{"dtick":1,"gridcolor":"rgb(0, 0, 0)","side":"top","ticks":"","title":{"text":"Predicted"}},"yaxis":{"dtick":1,"ticks":"","ticksuffix":"  ","title":{"text":"True"}},"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"title":{"text":"<i><b>Confusion matrix</b></i>"},"margin":{"t":50,"l":200}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('151907bc-4bae-4615-819d-beb24190cf40');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="119">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Data for the table</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [<span class="st">'Best Random Forest'</span>, <span class="st">'Best Naive Bayes'</span>, <span class="st">'Best SVM'</span>]</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>accuracies <span class="op">=</span> [<span class="fl">0.66</span>, <span class="fl">0.66</span>, <span class="fl">0.67</span>]</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>precision_0 <span class="op">=</span> [<span class="fl">0.77</span>, <span class="fl">0.75</span>, <span class="fl">0.72</span>]</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>recall_0 <span class="op">=</span> [<span class="fl">0.49</span>, <span class="fl">0.50</span>, <span class="fl">0.59</span>]</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>f1_0 <span class="op">=</span> [<span class="fl">0.60</span>, <span class="fl">0.60</span>, <span class="fl">0.65</span>]</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>precision_1 <span class="op">=</span> [<span class="fl">0.61</span>, <span class="fl">0.61</span>, <span class="fl">0.64</span>]</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>recall_1 <span class="op">=</span> [<span class="fl">0.84</span>, <span class="fl">0.83</span>, <span class="fl">0.76</span>]</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>f1_1 <span class="op">=</span> [<span class="fl">0.71</span>, <span class="fl">0.70</span>, <span class="fl">0.70</span>]</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the index corresponding to 'Best SVM' model</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>svm_index <span class="op">=</span> models.index(<span class="st">'Best SVM'</span>)</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list to hold the row colors</span></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>row_colors <span class="op">=</span> [<span class="st">'#EAEAEA'</span>, <span class="st">'#F5F5F5'</span>, <span class="st">'#EAEAEA'</span>]  <span class="co"># Example colors, feel free to customize</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Update the color for the 'Best SVM' row</span></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>row_colors[svm_index] <span class="op">=</span> <span class="st">'#66CDAA'</span>  <span class="co"># Highlight color for 'Best SVM' row</span></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a table</span></span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure(data<span class="op">=</span>[go.Table(</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>    header<span class="op">=</span><span class="bu">dict</span>(values<span class="op">=</span>[<span class="st">'Model'</span>, <span class="st">'Accuracy'</span>, <span class="st">'Precision (Class 0)'</span>, <span class="st">'Recall (Class 0)'</span>, <span class="st">'F1-Score (Class 0)'</span>,</span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>                         <span class="st">'Precision (Class 1)'</span>, <span class="st">'Recall (Class 1)'</span>, <span class="st">'F1-Score (Class 1)'</span>],</span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>                fill_color<span class="op">=</span><span class="st">'#2E4A62'</span>,  <span class="co"># Header color</span></span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>                font<span class="op">=</span><span class="bu">dict</span>(color<span class="op">=</span><span class="st">'white'</span>)),  <span class="co"># Font color for header</span></span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>    cells<span class="op">=</span><span class="bu">dict</span>(values<span class="op">=</span>[models, accuracies, precision_0, recall_0, f1_0, precision_1, recall_1, f1_1],</span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>               fill_color<span class="op">=</span>[row_colors]<span class="op">*</span><span class="bu">len</span>(models),  <span class="co"># Use row_colors for each row</span></span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>               align<span class="op">=</span><span class="st">'center'</span>))  <span class="co"># Center-align cell content</span></span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a><span class="co"># JavaScript code for hover effect</span></span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a>hover_code <span class="op">=</span> <span class="st">'''</span></span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;script&gt;</span></span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a><span class="st">    var table = document.getElementById("trace_0");</span></span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a><span class="st">    for (var i = 0; i &lt; table.rows.length; i++) {</span></span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a><span class="st">        table.rows[i].onmouseover = function () {</span></span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a><span class="st">            this.style.backgroundColor = '#ADD8E6';</span></span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true" tabindex="-1"></a><span class="st">        };</span></span>
<span id="cb68-42"><a href="#cb68-42" aria-hidden="true" tabindex="-1"></a><span class="st">        table.rows[i].onmouseout = function () {</span></span>
<span id="cb68-43"><a href="#cb68-43" aria-hidden="true" tabindex="-1"></a><span class="st">            this.style.backgroundColor = '';</span></span>
<span id="cb68-44"><a href="#cb68-44" aria-hidden="true" tabindex="-1"></a><span class="st">        };</span></span>
<span id="cb68-45"><a href="#cb68-45" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb68-46"><a href="#cb68-46" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;/script&gt;</span></span>
<span id="cb68-47"><a href="#cb68-47" aria-hidden="true" tabindex="-1"></a><span class="st">'''</span></span>
<span id="cb68-48"><a href="#cb68-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-49"><a href="#cb68-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Update the layout for better readability</span></span>
<span id="cb68-50"><a href="#cb68-50" aria-hidden="true" tabindex="-1"></a>fig.update_layout(title_text<span class="op">=</span><span class="st">'Model Comparison'</span>,</span>
<span id="cb68-51"><a href="#cb68-51" aria-hidden="true" tabindex="-1"></a>                  title_x<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb68-52"><a href="#cb68-52" aria-hidden="true" tabindex="-1"></a>                  width<span class="op">=</span><span class="dv">800</span>,</span>
<span id="cb68-53"><a href="#cb68-53" aria-hidden="true" tabindex="-1"></a>                  height<span class="op">=</span><span class="dv">400</span>,</span>
<span id="cb68-54"><a href="#cb68-54" aria-hidden="true" tabindex="-1"></a>                  margin<span class="op">=</span><span class="bu">dict</span>(l<span class="op">=</span><span class="dv">10</span>, r<span class="op">=</span><span class="dv">10</span>, b<span class="op">=</span><span class="dv">10</span>, t<span class="op">=</span><span class="dv">60</span>),  <span class="co"># Adjust margins for better layout</span></span>
<span id="cb68-55"><a href="#cb68-55" aria-hidden="true" tabindex="-1"></a>                  paper_bgcolor<span class="op">=</span><span class="st">'#F0F8FF'</span>,  <span class="co"># Background color</span></span>
<span id="cb68-56"><a href="#cb68-56" aria-hidden="true" tabindex="-1"></a>                  plot_bgcolor<span class="op">=</span><span class="st">'#F0F8FF'</span>)  <span class="co"># Plot area color</span></span>
<span id="cb68-57"><a href="#cb68-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-58"><a href="#cb68-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the figure as an HTML file with additional JavaScript code</span></span>
<span id="cb68-59"><a href="#cb68-59" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"/root/fall-2023-reddit-project-team-33/data/plots/model_comparison.html"</span>, <span class="st">"w"</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb68-60"><a href="#cb68-60" aria-hidden="true" tabindex="-1"></a>    <span class="bu">file</span>.write(fig.to_html() <span class="op">+</span> hover_code)</span>
<span id="cb68-61"><a href="#cb68-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-62"><a href="#cb68-62" aria-hidden="true" tabindex="-1"></a>fig.show()</span>
<span id="cb68-63"><a href="#cb68-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-64"><a href="#cb68-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-65"><a href="#cb68-65" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>                            <div id="5ea5a590-34af-4a3d-a020-406348ab52bc" class="plotly-graph-div" style="height:400px; width:800px;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("5ea5a590-34af-4a3d-a020-406348ab52bc")) {                    Plotly.newPlot(                        "5ea5a590-34af-4a3d-a020-406348ab52bc",                        [{"cells":{"align":"center","fill":{"color":[["#EAEAEA","#F5F5F5","#66CDAA"],["#EAEAEA","#F5F5F5","#66CDAA"],["#EAEAEA","#F5F5F5","#66CDAA"]]},"values":[["Best Random Forest","Best Naive Bayes","Best SVM"],[0.66,0.66,0.67],[0.77,0.75,0.72],[0.49,0.5,0.59],[0.6,0.6,0.65],[0.61,0.61,0.64],[0.84,0.83,0.76],[0.71,0.7,0.7]]},"header":{"fill":{"color":"#2E4A62"},"font":{"color":"white"},"values":["Model","Accuracy","Precision (Class 0)","Recall (Class 0)","F1-Score (Class 0)","Precision (Class 1)","Recall (Class 1)","F1-Score (Class 1)"]},"type":"table"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"title":{"text":"Model Comparison","x":0.5},"margin":{"l":10,"r":10,"b":10,"t":60},"width":800,"height":400,"paper_bgcolor":"#F0F8FF","plot_bgcolor":"#F0F8FF"},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('5ea5a590-34af-4a3d-a020-406348ab52bc');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<p>We performed parameter tuning for logistic regression, SVM, and Naive Bayes. However, we observed that the overall predictive performance did not show significant improvement compared to the results before parameter adjustment. The accuracy has been maintained at around 0.67.Therefore, we select the Best SVM model as the Best model overall. Because The accuracy show the smallest different between two classes.</p>
<p>Why SVM is Chosen as the Best Model:</p>
<p>Overall Accuracy: SVM has the highest overall accuracy (0.67), indicating better overall performance in making correct predictions.</p>
<p>Class 1 Performance: SVM shows competitive or superior precision, recall, and F1-score for predicting instances of Class 1 compared to other models.</p>
<p>Class 0 Performance: Similar positive performance trends are observed for predicting instances of Class 0.</p>
<p>Consideration of Metrics: The choice depends on the specific goals; SVM is selected based on a balance of precision, recall, and F1-score.</p>
<p>Domain Relevance: Depending on the application, certain metrics may be more crucial. Consider the consequences of false positives and false negatives in your context.</p>
<p>Cross-Validation: Ensure consistent performance across different datasets, as the table may represent results for a specific dataset.</p>
<p>In summary, SVM emerges as the preferred model due to its higher overall accuracy and competitive performance in key metrics, making it well-suited for the specific objectives of the project.</p>
<p>### Understanding the Best Model: We’ve used fancy techniques to find the best settings for our model, and it turns out that the best version uses certain numbers and settings. The model, which is like a smart tool, got a score of 67 out of 100 in how well it does its job.</p>
</section>
<section id="checking-how-good-it-is" class="level3">
<h3 class="anchored" data-anchor-id="checking-how-good-it-is">Checking How Good it Is:</h3>
<p>We looked at how well the tool does for different kinds of comments. For regular comments, it’s about 72% correct, but it misses some (about 59%). For tricky comments, it’s about 64% correct, but it’s better at finding most of them (about 76%).</p>
</section>
<section id="what-it-means-for-our-goal" class="level3">
<h3 class="anchored" data-anchor-id="what-it-means-for-our-goal">What it Means for Our Goal:</h3>
<p>Our goal was to spot comments that might cause a fuss. The tool is a bit better at finding these kinds of comments, especially the tricky ones. So, it can help us keep an eye on discussions that might get people talking or arguing.</p>
</section>
<section id="how-we-can-use-it" class="level3">
<h3 class="anchored" data-anchor-id="how-we-can-use-it">How We Can Use It:</h3>
<p><strong>Helping Keep Things Nice:</strong> We can use the tool to help check comments automatically and find ones that might need a closer look. This way, we keep the conversation friendly and positive.</p>
<p><strong>Learning What People Like:</strong> By looking at tricky comments, we can learn more about what people are interested in or care about. This helps us make the platform more interesting for everyone.</p>
<p><strong>Avoiding Problems:</strong> Spotting tricky comments early can help us avoid problems before they happen. It’s like having a friend who tells us when something might not be going well.</p>
<p><strong>Checking and Improving:</strong> We’ll keep an eye on how well the tool is doing and make it even better over time. Just like apps get updates on your phone, our tool will get smarter to keep up with how people talk.</p>
<p><em>Remember, while the tool is helpful, it’s not perfect. We still need real people to make the final decisions, especially when things are a bit tricky or sensitive. Combining the tool with human judgment helps us make sure everything goes smoothly on our platform.</em></p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>